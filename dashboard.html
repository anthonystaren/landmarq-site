<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600&family=Syne:wght@400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LandMarq ‚Äî Executive Intelligence Dashboard</title>
<style>
:root {
  --bg: #0B0D0F;
  --surface: #111418;
  --surface-2: #181C22;
  --surface-3: #1E232B;
  --border: rgba(255,255,255,0.07);
  --border-gold: rgba(196,158,84,0.25);
  --gold: #C49E54;
  --gold-dim: rgba(196,158,84,0.12);
  --gold-bright: #E8C97A;
  --cream: #F0EAD6;
  --text: #D4CCBA;
  --text-dim: #6B6558;
  --text-mid: #9B9080;
  --green: #4A9B6F;
  --green-dim: rgba(74,155,111,0.15);
  --red: #C0533A;
  --red-dim: rgba(192,83,58,0.15);
  --blue: #4A7FA5;
  --blue-dim: rgba(74,127,165,0.15);
  --amber: #D4883A;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow: hidden; }

/* Auth gate: hide everything until verified */
body:not(.auth-ready) > *:not(script) { opacity: 0; }
body.auth-ready > * { transition: opacity 0.3s ease; opacity: 1; }

body {
  font-family: 'Syne', sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* ‚îÄ‚îÄ‚îÄ ONBOARDING OVERLAY ‚îÄ‚îÄ‚îÄ */
#onboarding-overlay {
  position: fixed;
  inset: 0;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(11,13,15,0.92);
  backdrop-filter: blur(8px);
  transition: opacity 0.4s;
}

#onboarding-overlay.hidden {
  opacity: 0;
  pointer-events: none;
}

.onboarding-modal {
  background: var(--surface);
  border: 1px solid var(--border-gold);
  border-radius: 12px;
  width: 620px;
  max-width: 95vw;
  overflow: hidden;
  box-shadow: 0 40px 120px rgba(0,0,0,0.6), 0 0 0 1px rgba(196,158,84,0.1);
  animation: modalIn 0.5s cubic-bezier(0.34,1.56,0.64,1);
}

@keyframes modalIn {
  from { opacity: 0; transform: translateY(30px) scale(0.95); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.ob-header {
  padding: 28px 32px 0;
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
}

.ob-logo {
  font-family: 'Cormorant Garamond', serif;
  font-size: 24px;
  font-weight: 600;
  color: var(--cream);
  letter-spacing: 0.04em;
}

.ob-logo span { color: var(--gold); }

.ob-step-counter {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  letter-spacing: 0.15em;
  color: var(--text-dim);
  text-transform: uppercase;
  margin-top: 4px;
}

.ob-progress {
  height: 2px;
  background: var(--surface-3);
  margin: 20px 32px 0;
  border-radius: 1px;
  overflow: hidden;
}

.ob-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--gold), var(--gold-bright));
  border-radius: 1px;
  transition: width 0.5s cubic-bezier(0.4,0,0.2,1);
}

.ob-body {
  padding: 28px 32px;
  min-height: 260px;
}

.ob-step { display: none; }
.ob-step.active { display: block; animation: stepIn 0.3s ease-out; }

@keyframes stepIn {
  from { opacity: 0; transform: translateX(16px); }
  to { opacity: 1; transform: translateX(0); }
}

.ob-step-icon {
  font-size: 36px;
  margin-bottom: 16px;
  display: block;
}

.ob-step-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: 28px;
  font-weight: 600;
  color: var(--cream);
  line-height: 1.2;
  margin-bottom: 12px;
}

.ob-step-title em { font-style: italic; color: var(--gold); }

.ob-step-desc {
  font-size: 14px;
  color: var(--text-mid);
  line-height: 1.7;
  margin-bottom: 20px;
  font-weight: 400;
}

.ob-features {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-top: 16px;
}

.ob-feature {
  background: var(--surface-3);
  border: 1px solid rgba(255,255,255,0.09);
  border-radius: 6px;
  padding: 12px 14px;
  display: flex;
  align-items: flex-start;
  gap: 10px;
  transition: border-color 0.2s;
}

.ob-feature:hover { border-color: var(--border-gold); }

.ob-feature-icon { font-size: 16px; flex-shrink: 0; margin-top: 1px; }

.ob-feature-text { font-size: 12px; color: var(--text); line-height: 1.4; }
.ob-feature-text strong { color: var(--cream); display: block; margin-bottom: 2px; font-size: 12px; }

/* Onboarding interactive steps */
.ob-input-group { margin-bottom: 12px; }
.ob-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 6px;
  display: block;
}

.ob-input {
  width: 100%;
  background: var(--surface-2);
  border: 1px solid var(--border);
  border-radius: 5px;
  padding: 10px 14px;
  color: var(--cream);
  font-family: 'Syne', sans-serif;
  font-size: 13px;
  outline: none;
  transition: border-color 0.2s;
}

.ob-input:focus { border-color: var(--gold); }

.ob-chips-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
}

.ob-chip {
  padding: 7px 14px;
  border-radius: 4px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  cursor: pointer;
  border: 1px solid var(--border);
  background: var(--surface-2);
  color: var(--text-dim);
  transition: all 0.15s;
  user-select: none;
}

.ob-chip:hover { color: var(--text); border-color: rgba(255,255,255,0.15); }
.ob-chip.selected { background: var(--gold-dim); color: var(--gold); border-color: var(--border-gold); }

.ob-agent-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-top: 10px;
}

.ob-agent-toggle {
  background: var(--surface-2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 12px 14px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.15s;
}

.ob-agent-toggle.on { border-color: var(--border-gold); background: var(--gold-dim); }

.ob-agent-toggle .toggle-icon { font-size: 16px; }

.ob-agent-toggle .toggle-info {}
.ob-agent-toggle .toggle-name { font-size: 11px; color: var(--cream); font-weight: 600; }
.ob-agent-toggle .toggle-desc { font-size: 10px; color: var(--text-dim); margin-top: 1px; }

.ob-agent-toggle .toggle-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--surface-3);
  border: 1px solid var(--border);
  margin-left: auto;
  flex-shrink: 0;
  transition: all 0.2s;
}

.ob-agent-toggle.on .toggle-dot { background: var(--green); border-color: var(--green); box-shadow: 0 0 6px rgba(74,155,111,0.5); }

.ob-footer {
  padding: 20px 32px 28px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-top: 1px solid var(--border);
}

.ob-btn-skip {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--text-dim);
  cursor: pointer;
  transition: color 0.15s;
  background: none;
  border: none;
}

.ob-btn-skip:hover { color: var(--text); }

.ob-btn-next {
  background: var(--gold);
  color: var(--bg);
  font-family: 'Syne', sans-serif;
  font-size: 13px;
  font-weight: 600;
  padding: 11px 28px;
  border-radius: 5px;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s;
}

.ob-btn-next:hover { background: var(--gold-bright); transform: translateY(-1px); box-shadow: 0 6px 20px rgba(196,158,84,0.25); }

/* Spotlight highlight for tour steps */
.spotlight-ring {
  position: fixed;
  border: 2px solid var(--gold);
  border-radius: 8px;
  box-shadow: 0 0 0 4000px rgba(11,13,15,0.7), 0 0 30px rgba(196,158,84,0.3);
  transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
  z-index: 990;
  pointer-events: none;
  display: none;
}

.spotlight-ring.visible { display: block; }

.spotlight-tooltip {
  position: fixed;
  background: var(--surface-3);
  border: 1px solid var(--border-gold);
  border-radius: 8px;
  padding: 16px 20px;
  width: 280px;
  z-index: 995;
  display: none;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  animation: tooltipIn 0.3s ease-out;
}

@keyframes tooltipIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.spotlight-tooltip.visible { display: block; }

.tooltip-step { font-family: 'JetBrains Mono', monospace; font-size: 8px; letter-spacing: 0.15em; color: var(--gold); text-transform: uppercase; margin-bottom: 6px; }
.tooltip-title { font-family: 'Cormorant Garamond', serif; font-size: 17px; font-weight: 600; color: var(--cream); margin-bottom: 6px; }
.tooltip-desc { font-size: 12px; color: var(--text-mid); line-height: 1.55; }
.tooltip-nav { display: flex; justify-content: space-between; align-items: center; margin-top: 14px; }
.tooltip-nav-btn {
  font-family: 'JetBrains Mono', monospace; font-size: 8px; letter-spacing: 0.1em; text-transform: uppercase;
  padding: 6px 14px; border-radius: 4px; cursor: pointer; border: 1px solid var(--border-gold);
  background: var(--gold-dim); color: var(--gold); transition: all 0.15s;
}
.tooltip-nav-btn:hover { background: rgba(196,158,84,0.25); }
.tooltip-close { font-family: 'JetBrains Mono', monospace; font-size: 8px; color: var(--text-dim); cursor: pointer; letter-spacing: 0.08em; text-transform: uppercase; }
.tooltip-close:hover { color: var(--text); }

/* ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ */
.sidebar {
  width: 220px;
  flex-shrink: 0;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.sidebar-logo {
  padding: 22px 22px 18px;
  border-bottom: 1px solid var(--border);
}

.logo-wordmark {
  font-family: 'Cormorant Garamond', serif;
  font-size: 22px;
  font-weight: 600;
  color: var(--cream);
  letter-spacing: 0.04em;
  line-height: 1;
}

.logo-wordmark .lm-land { color: var(--cream); }
.logo-wordmark .lm-marq { color: var(--gold); }

.logo-sub {
  font-family: 'JetBrains Mono', monospace;
  font-size: 7.5px;
  letter-spacing: 0.2em;
  color: var(--text-dim);
  text-transform: uppercase;
  margin-top: 4px;
}

.user-card {
  padding: 14px 22px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 10px;
}

.user-avatar {
  width: 32px; height: 32px; border-radius: 50%;
  background: linear-gradient(135deg, var(--gold), #8B6A2E);
  display: flex; align-items: center; justify-content: center;
  font-family: 'Cormorant Garamond', serif;
  font-size: 14px; font-weight: 600; color: var(--bg); flex-shrink: 0;
}

.user-name { font-size: 12px; font-weight: 600; color: var(--cream); line-height: 1.2; }
.user-title { font-family: 'JetBrains Mono', monospace; font-size: 7.5px; color: var(--text-dim); letter-spacing: 0.05em; margin-top: 2px; }

.nav-section { padding: 14px 0 6px; }
.nav-label { font-family: 'JetBrains Mono', monospace; font-size: 7px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text-dim); padding: 0 22px 8px; }

.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 9px 22px; cursor: pointer; transition: all 0.15s;
  border-left: 2px solid transparent; font-size: 12px; font-weight: 500; color: var(--text-dim);
}

.nav-item:hover { color: var(--text); background: rgba(255,255,255,0.03); }
.nav-item.active { color: var(--gold); border-left-color: var(--gold); background: var(--gold-dim); }
.nav-icon { width: 15px; text-align: center; font-size: 11px; }

.nav-badge {
  margin-left: auto; background: var(--red); color: white;
  font-family: 'JetBrains Mono', monospace; font-size: 8px;
  padding: 2px 6px; border-radius: 10px;
}
.nav-badge.green { background: var(--green); }
.nav-badge.gold { background: var(--gold); color: var(--bg); }

.sidebar-footer {
  margin-top: auto; padding: 14px 22px; border-top: 1px solid var(--border);
}

.pulse-dot {
  width: 7px; height: 7px; background: var(--green); border-radius: 50%;
  animation: pulseDot 2.5s ease-in-out infinite; flex-shrink: 0;
}
@keyframes pulseDot {
  0%,100% { box-shadow: 0 0 0 0 rgba(74,155,111,0.4); }
  50% { box-shadow: 0 0 0 5px rgba(74,155,111,0); }
}

.status-indicator { display: flex; align-items: center; gap: 8px; }
.status-text { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--green); letter-spacing: 0.08em; }

/* ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ */
.main { flex: 1; display: flex; flex-direction: column; overflow: hidden; min-width: 0; }

.topbar {
  height: 54px; border-bottom: 1px solid var(--border);
  display: flex; align-items: center; padding: 0 24px; gap: 16px;
  flex-shrink: 0; background: var(--surface);
}

.topbar-title { font-family: 'Cormorant Garamond', serif; font-size: 18px; font-weight: 600; color: var(--cream); letter-spacing: 0.02em; }
.topbar-date { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--text-dim); letter-spacing: 0.1em; text-transform: uppercase; }

.topbar-right { margin-left: auto; display: flex; align-items: center; gap: 10px; }

.topbar-chip {
  display: flex; align-items: center; gap: 6px;
  background: var(--gold-dim); border: 1px solid var(--border-gold);
  border-radius: 3px; padding: 5px 12px;
  font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--gold);
  letter-spacing: 0.1em; text-transform: uppercase;
}

/* ‚îÄ‚îÄ ADD INTELLIGENCE BUTTON ‚îÄ‚îÄ */
.add-intel-btn {
  display: flex; align-items: center; gap: 7px;
  background: var(--gold); color: var(--bg);
  border: none; border-radius: 4px; padding: 7px 16px;
  font-family: 'Syne', sans-serif; font-size: 12px; font-weight: 600;
  cursor: pointer; transition: all 0.2s; white-space: nowrap;
}
.add-intel-btn:hover { background: var(--gold-bright); transform: translateY(-1px); box-shadow: 0 4px 16px rgba(196,158,84,0.25); }

.add-deal-btn {
  background: var(--surface-2); color: var(--gold); border: 1px solid var(--border-gold);
  border-radius: 4px; padding: 5px 12px; font-family: 'Syne', sans-serif;
  font-size: 10px; font-weight: 600; cursor: pointer; transition: all 0.2s;
  letter-spacing: 0.02em;
}
.add-deal-btn:hover { background: var(--gold-dim); }

.icon-btn {
  width: 32px; height: 32px; border-radius: 4px;
  background: var(--surface-2); border: 1px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; font-size: 13px; color: var(--text-dim); transition: all 0.15s;
}
.icon-btn:hover { color: var(--text); border-color: rgba(255,255,255,0.15); }

/* ‚îÄ‚îÄ‚îÄ CONTENT ‚îÄ‚îÄ‚îÄ */
.content {
  flex: 1; overflow-y: auto; overflow-x: hidden; padding: 18px 20px 40px;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 310px;
  grid-template-rows: auto auto auto auto auto;
  gap: 12px; align-content: start;
}

.content::-webkit-scrollbar { width: 3px; }
.content::-webkit-scrollbar-thumb { background: var(--surface-3); border-radius: 2px; }

/* ‚îÄ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ‚îÄ */
.card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 6px; overflow: hidden; transition: border-color 0.2s;
}
.card:hover { border-color: rgba(255,255,255,0.11); }

.card-header {
  padding: 13px 16px 0;
  display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;
}

.card-title {
  font-family: 'JetBrains Mono', monospace; font-size: 8.5px;
  letter-spacing: 0.18em; text-transform: uppercase; color: var(--text-dim);
  display: flex; align-items: center; gap: 7px;
}
.card-title::before { content: ''; width: 3px; height: 3px; background: var(--gold); border-radius: 50%; }

.card-action { font-family: 'JetBrains Mono', monospace; font-size: 8px; letter-spacing: 0.1em; color: var(--text-dim); cursor: pointer; transition: color 0.15s; text-transform: uppercase; }
.card-action:hover { color: var(--gold); }

/* ‚îÄ‚îÄ‚îÄ KPI ROW ‚îÄ‚îÄ‚îÄ */
.kpi-row { grid-column: 1 / -1; display: grid; grid-template-columns: repeat(6,1fr); gap: 12px; }

.kpi-card {
  background: var(--surface); border: 1px solid var(--border); border-radius: 6px;
  padding: 14px 16px; position: relative; overflow: hidden; cursor: default; transition: all 0.2s;
}

.kpi-card::after {
  content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px;
  background: var(--gold); transform: scaleX(0); transform-origin: left; transition: transform 0.3s;
}
.kpi-card:hover::after { transform: scaleX(1); }
.kpi-card:hover { border-color: var(--border-gold); }

.kpi-label { font-family: 'JetBrains Mono', monospace; font-size: 7px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--text-dim); margin-bottom: 8px; }
.kpi-value { font-family: 'Cormorant Garamond', serif; font-size: 30px; font-weight: 300; color: var(--cream); line-height: 1; letter-spacing: -0.01em; }
.kpi-value.gold { color: var(--gold); }
.kpi-delta { display: flex; align-items: center; gap: 4px; margin-top: 5px; font-family: 'JetBrains Mono', monospace; font-size: 8.5px; }
.delta-up { color: var(--green); }
.delta-down { color: var(--red); }
.delta-neutral { color: var(--text-dim); }
.kpi-sub { font-size: 9px; color: var(--text-dim); margin-left: 3px; }

/* ‚îÄ‚îÄ‚îÄ HEATMAP ‚îÄ‚îÄ‚îÄ */
.heatmap-card { grid-column: 1 / 3; }
.heatmap-body { padding: 0 16px 14px; }
.heatmap-grid { display: grid; grid-template-columns: repeat(5,1fr); gap: 5px; }
.heatmap-cell { border-radius: 4px; padding: 9px 7px; cursor: pointer; transition: all 0.2s; }
.heatmap-cell:hover { filter: brightness(1.25); transform: scale(1.05); z-index: 1; position: relative; }
.heat-market { font-size: 8.5px; font-weight: 600; color: rgba(255,255,255,0.9); margin-bottom: 2px; line-height: 1.2; }
.heat-val { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: rgba(255,255,255,0.7); }

/* ‚îÄ‚îÄ‚îÄ AGENT FEED ‚îÄ‚îÄ‚îÄ */
.agents-card { grid-column: 3 / 4; }
.agent-stream { padding: 0 16px 14px; display: flex; flex-direction: column; gap: 1px; max-height: 230px; overflow-y: auto; }
.agent-stream::-webkit-scrollbar { width: 2px; }
.agent-stream::-webkit-scrollbar-thumb { background: var(--border); }

.stream-item { display: flex; gap: 9px; padding: 8px 0; border-bottom: 1px solid var(--border); animation: streamIn 0.4s ease-out; }
@keyframes streamIn { from { opacity:0; transform:translateX(-8px); } to { opacity:1; transform:translateX(0); } }

.stream-icon { width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; flex-shrink: 0; margin-top: 1px; }
.icon-intel { background: var(--blue-dim); border: 1px solid rgba(74,127,165,0.3); }
.icon-lead { background: var(--gold-dim); border: 1px solid var(--border-gold); }
.icon-doc { background: var(--green-dim); border: 1px solid rgba(74,155,111,0.3); }
.icon-alert { background: var(--red-dim); border: 1px solid rgba(192,83,58,0.3); }

.stream-text { font-size: 11px; color: var(--text); line-height: 1.4; font-weight: 400; }
.stream-text strong { color: var(--cream); font-weight: 600; }
.stream-meta { font-family: 'JetBrains Mono', monospace; font-size: 7.5px; color: var(--text-dim); margin-top: 2px; letter-spacing: 0.04em; display: flex; align-items: center; gap: 6px; }
.stream-tag { padding: 1px 5px; border-radius: 2px; font-size: 7px; letter-spacing: 0.08em; text-transform: uppercase; }
.tag-intel { background: var(--blue-dim); color: var(--blue); }
.tag-lead { background: var(--gold-dim); color: var(--gold); }
.tag-doc { background: var(--green-dim); color: var(--green); }
.tag-alert { background: var(--red-dim); color: var(--red); }

.typing-dot { display: inline-block; width: 4px; height: 4px; background: var(--gold); border-radius: 50%; animation: typeDot 1.4s ease-in-out infinite; margin: 0 1px; }
.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }
@keyframes typeDot { 0%,60%,100% { transform:translateY(0);opacity:0.3; } 30% { transform:translateY(-4px);opacity:1; } }

/* ‚îÄ‚îÄ‚îÄ ALERTS (right column) ‚îÄ‚îÄ‚îÄ */
.alerts-card { grid-column: 4/5; grid-row: 2/6; align-self: start; }
.alerts-body { padding: 0 13px 14px; display: flex; flex-direction: column; gap: 7px; max-height: 660px; overflow-y: auto; }
.alerts-body::-webkit-scrollbar { width: 2px; }
.alerts-body::-webkit-scrollbar-thumb { background: var(--border); }

.alert-item { border-radius: 5px; padding: 11px 12px; cursor: pointer; transition: all 0.2s; border: 1px solid transparent; }
.alert-item:hover { filter: brightness(1.1); }
.alert-high { background: var(--red-dim); border-color: rgba(192,83,58,0.2); border-left: 3px solid var(--red); }
.alert-med { background: rgba(212,136,58,0.08); border-color: rgba(212,136,58,0.2); border-left: 3px solid var(--amber); }
.alert-low { background: var(--blue-dim); border-color: rgba(74,127,165,0.2); border-left: 3px solid var(--blue); }

.alert-priority { font-family: 'JetBrains Mono', monospace; font-size: 7px; letter-spacing: 0.15em; text-transform: uppercase; margin-bottom: 4px; }
.alert-high .alert-priority { color: var(--red); }
.alert-med .alert-priority { color: var(--amber); }
.alert-low .alert-priority { color: var(--blue); }
.alert-title { font-size: 11px; font-weight: 600; color: var(--cream); line-height: 1.3; margin-bottom: 3px; }
.alert-body { font-size: 9.5px; color: var(--text-dim); line-height: 1.5; }
.alert-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 6px; }
.alert-agent { font-family: 'JetBrains Mono', monospace; font-size: 7px; color: var(--text-dim); }
.alert-time { font-family: 'JetBrains Mono', monospace; font-size: 7px; color: var(--text-dim); }
.alert-action-btn {
  display: block; width: 100%; text-align: center; margin-top: 5px; padding: 5px;
  border-radius: 3px; font-family: 'JetBrains Mono', monospace; font-size: 8px;
  letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer;
  border: 1px solid rgba(196,158,84,0.3); color: var(--gold); background: var(--gold-dim);
  transition: all 0.15s;
}
.alert-action-btn:hover { background: rgba(196,158,84,0.22); }

/* ‚îÄ‚îÄ‚îÄ SPARKLINES ‚îÄ‚îÄ‚îÄ */
.sparkline-row { grid-column: 1/4; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
.spark-body { padding: 0 16px 14px; }
.spark-stat { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 8px; }
.spark-big { font-family: 'Cormorant Garamond', serif; font-size: 26px; font-weight: 300; color: var(--cream); line-height: 1; }
.spark-delta { font-family: 'JetBrains Mono', monospace; font-size: 9px; }
.spark-main { display: flex; align-items: flex-end; gap: 2px; height: 46px; }
.spark-bar { flex: 1; border-radius: 2px 2px 0 0; transition: all 0.3s; cursor: pointer; }
.spark-bar:hover { filter: brightness(1.4); }
.spark-bar.gold-bar { background: var(--gold-dim); border: 1px solid rgba(196,158,84,0.2); }
.spark-bar.gold-bar.current { background: var(--gold); }
.spark-bar.green-bar { background: var(--green-dim); border: 1px solid rgba(74,155,111,0.2); }
.spark-bar.green-bar.current { background: var(--green); }
.spark-bar.blue-bar { background: var(--blue-dim); border: 1px solid rgba(74,127,165,0.2); }
.spark-bar.blue-bar.current { background: var(--blue); }
.spark-labels { display: flex; justify-content: space-between; margin-top: 5px; }
.spark-label { font-family: 'JetBrains Mono', monospace; font-size: 7px; color: var(--text-dim); }

/* ‚îÄ‚îÄ‚îÄ PIPELINE ‚îÄ‚îÄ‚îÄ */
.pipeline-card { grid-column: 1/4; }
.pipeline-body { padding: 0 16px 14px; }
.pipeline-table { width: 100%; border-collapse: collapse; font-size: 11px; }
.pipeline-table th { font-family: 'JetBrains Mono', monospace; font-size: 7px; letter-spacing: 0.18em; text-transform: uppercase; color: var(--text-dim); text-align: left; padding: 0 8px 8px 0; border-bottom: 1px solid var(--border); white-space: nowrap; }
.pipeline-table td { padding: 10px 8px 10px 0; border-bottom: 1px solid var(--border); color: var(--text); vertical-align: middle; }
.pipeline-table tr:last-child td { border-bottom: none; }
.pipeline-table tr:hover td { color: var(--cream); background: rgba(255,255,255,0.015); }
.tenant-name { font-weight: 600; color: var(--cream); font-size: 11.5px; }
.tenant-sub { font-family: 'JetBrains Mono', monospace; font-size: 7.5px; color: var(--text-dim); margin-top: 2px; }
.size-val { font-family: 'JetBrains Mono', monospace; font-size: 10.5px; }
.value-cell { font-family: 'Cormorant Garamond', serif; font-size: 15px; font-weight: 600; color: var(--cream); }
.market-tag { font-family: 'JetBrains Mono', monospace; font-size: 8px; padding: 2px 7px; background: var(--surface-3); border-radius: 2px; color: var(--text-dim); white-space: nowrap; }
.stage-pill { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 20px; font-family: 'JetBrains Mono', monospace; font-size: 7.5px; letter-spacing: 0.08em; text-transform: uppercase; white-space: nowrap; }
.stage-prospect { background: var(--blue-dim); color: var(--blue); border: 1px solid rgba(74,127,165,0.2); }
.stage-qualify { background: rgba(212,136,58,0.1); color: var(--amber); border: 1px solid rgba(212,136,58,0.2); }
.stage-proposal { background: var(--gold-dim); color: var(--gold); border: 1px solid var(--border-gold); }
.stage-loi { background: var(--green-dim); color: var(--green); border: 1px solid rgba(74,155,111,0.2); }
.prob-bar-wrap { display: flex; align-items: center; gap: 7px; }
.prob-bar-bg { flex: 1; height: 3px; background: var(--surface-3); border-radius: 2px; overflow: hidden; min-width: 40px; }
.prob-bar-fill { height: 100%; border-radius: 2px; background: var(--gold); }
.prob-bar-fill.green { background: var(--green); }
.prob-bar-fill.blue { background: var(--blue); }
.prob-bar-fill.amber { background: var(--amber); }
.prob-val { font-family: 'JetBrains Mono', monospace; font-size: 8.5px; color: var(--text-mid); white-space: nowrap; }
.action-dots { display: flex; gap: 3px; cursor: pointer; padding: 4px; }
.action-dots span { width: 3px; height: 3px; background: var(--text-dim); border-radius: 50%; }

/* ‚îÄ‚îÄ‚îÄ ADD INTELLIGENCE PANEL ‚îÄ‚îÄ‚îÄ */
#intel-panel {
  position: fixed; right: 0; top: 0; bottom: 0; width: 440px;
  background: var(--surface); border-left: 1px solid var(--border-gold);
  z-index: 500; transform: translateX(100%);
  transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
  display: flex; flex-direction: column;
  box-shadow: -20px 0 60px rgba(0,0,0,0.4);
}

#intel-panel.open { transform: translateX(0); }

.panel-header {
  padding: 22px 24px 18px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: flex-start; justify-content: space-between;
  flex-shrink: 0;
}

.panel-title { font-family: 'Cormorant Garamond', serif; font-size: 22px; font-weight: 600; color: var(--cream); }
.panel-sub { font-family: 'JetBrains Mono', monospace; font-size: 8.5px; color: var(--text-dim); letter-spacing: 0.1em; text-transform: uppercase; margin-top: 3px; }
.panel-close { width: 28px; height: 28px; border-radius: 4px; background: var(--surface-2); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 14px; color: var(--text-dim); transition: all 0.15s; }
.panel-close:hover { color: var(--cream); border-color: rgba(255,255,255,0.15); }

.panel-body { flex: 1; overflow-y: auto; padding: 20px 24px; }
.panel-body::-webkit-scrollbar { width: 3px; }
.panel-body::-webkit-scrollbar-thumb { background: var(--surface-3); }

.panel-section { margin-bottom: 24px; }
.panel-section-title { font-family: 'JetBrains Mono', monospace; font-size: 8px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--gold); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.panel-section-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }

/* Category selector */
.cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.cat-btn {
  padding: 12px 14px; border-radius: 5px; cursor: pointer;
  border: 1px solid var(--border); background: var(--surface-2);
  text-align: left; transition: all 0.15s; display: flex; align-items: center; gap: 10px;
}
.cat-btn:hover { border-color: rgba(255,255,255,0.15); }
.cat-btn.active { border-color: var(--border-gold); background: var(--gold-dim); }
.cat-btn-icon { font-size: 18px; flex-shrink: 0; }
.cat-btn-info {}
.cat-btn-name { font-size: 11px; font-weight: 600; color: var(--cream); }
.cat-btn-desc { font-size: 9.5px; color: var(--text-dim); margin-top: 1px; }

/* NLP input */
.nlp-input-wrap { position: relative; }
.nlp-input {
  width: 100%; background: var(--surface-2); border: 1px solid var(--border);
  border-radius: 5px; padding: 12px 46px 12px 14px; color: var(--cream);
  font-family: 'Syne', sans-serif; font-size: 13px; outline: none;
  transition: border-color 0.2s; resize: none; height: 80px; line-height: 1.5;
}
.nlp-input:focus { border-color: var(--gold); }
.nlp-input::placeholder { color: var(--text-dim); font-size: 12px; }
.nlp-send-btn {
  position: absolute; right: 10px; bottom: 10px; width: 28px; height: 28px;
  background: var(--gold); border-radius: 3px; border: none; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; transition: all 0.15s; color: var(--bg);
}
.nlp-send-btn:hover { background: var(--gold-bright); }

.nlp-suggestions { margin-top: 10px; display: flex; flex-direction: column; gap: 5px; }
.nlp-suggestion {
  padding: 8px 12px; border-radius: 4px; cursor: pointer;
  background: var(--surface-2); border: 1px solid var(--border);
  font-size: 11.5px; color: var(--text-mid); transition: all 0.15s; line-height: 1.4;
}
.nlp-suggestion:hover { color: var(--cream); border-color: var(--border-gold); background: var(--gold-dim); }
.nlp-suggestion::before { content: '"'; color: var(--gold); margin-right: 2px; }
.nlp-suggestion::after { content: '"'; color: var(--gold); margin-left: 2px; }

/* Active watches */
.watch-list { display: flex; flex-direction: column; gap: 7px; }
.watch-item {
  background: var(--surface-2); border: 1px solid var(--border); border-radius: 5px;
  padding: 10px 13px; display: flex; align-items: flex-start; gap: 10px; transition: all 0.2s;
}
.watch-item:hover { border-color: rgba(255,255,255,0.12); }
.watch-item-icon { font-size: 14px; margin-top: 1px; flex-shrink: 0; }
.watch-item-info { flex: 1; }
.watch-item-title { font-size: 11.5px; font-weight: 600; color: var(--cream); margin-bottom: 2px; }
.watch-item-meta { font-family: 'JetBrains Mono', monospace; font-size: 8px; color: var(--text-dim); letter-spacing: 0.04em; }
.watch-item-freq {
  font-family: 'JetBrains Mono', monospace; font-size: 7.5px; letter-spacing: 0.08em;
  padding: 2px 7px; border-radius: 2px; background: var(--gold-dim); color: var(--gold);
  border: 1px solid var(--border-gold); white-space: nowrap; margin-top: 4px; display: inline-block;
}
.watch-remove { width: 20px; height: 20px; border-radius: 3px; background: none; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 10px; color: var(--text-dim); transition: all 0.15s; flex-shrink: 0; }
.watch-remove:hover { border-color: var(--red); color: var(--red); background: var(--red-dim); }

/* area/zip input */
.panel-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
.panel-input {
  width: 100%; background: var(--surface-2); border: 1px solid var(--border); border-radius: 4px;
  padding: 9px 12px; color: var(--cream); font-family: 'Syne', sans-serif; font-size: 12px; outline: none; transition: border-color 0.2s;
}
.panel-input:focus { border-color: var(--gold); }
.panel-input::placeholder { color: var(--text-dim); font-size: 11px; }
.panel-label { font-family: 'JetBrains Mono', monospace; font-size: 8px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-dim); margin-bottom: 5px; display: block; }

.panel-add-btn {
  width: 100%; padding: 11px; background: var(--gold); color: var(--bg);
  font-family: 'Syne', sans-serif; font-size: 12px; font-weight: 600;
  border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; margin-top: 4px;
}
.panel-add-btn:hover { background: var(--gold-bright); }

/* Frequency selector */
.freq-row { display: flex; gap: 6px; }
.freq-btn {
  flex: 1; padding: 7px 5px; border-radius: 4px; cursor: pointer; text-align: center;
  border: 1px solid var(--border); background: var(--surface-2);
  font-family: 'JetBrains Mono', monospace; font-size: 8px; letter-spacing: 0.1em;
  text-transform: uppercase; color: var(--text-dim); transition: all 0.15s;
}
.freq-btn:hover { color: var(--text); border-color: rgba(255,255,255,0.15); }
.freq-btn.active { border-color: var(--border-gold); background: var(--gold-dim); color: var(--gold); }

/* Success toast */
.toast {
  position: fixed; bottom: 24px; right: 24px; z-index: 900;
  background: var(--surface); border: 1px solid var(--green);
  border-radius: 6px; padding: 13px 18px; display: flex; align-items: center; gap: 10px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.4);
  transform: translateY(80px); opacity: 0; transition: all 0.35s cubic-bezier(0.34,1.56,0.64,1);
}
.toast.show { transform: translateY(0); opacity: 1; }
.toast-icon { font-size: 16px; }
.toast-text { font-size: 12px; color: var(--cream); }
.toast-text strong { color: var(--green); }

/* Animations */
@keyframes fadeSlideUp { from { opacity:0; transform:translateY(14px); } to { opacity:1; transform:translateY(0); } }
.card, .kpi-card { animation: fadeSlideUp 0.5s ease-out both; }
.kpi-card:nth-child(1) { animation-delay: 0.05s; }
.kpi-card:nth-child(2) { animation-delay: 0.10s; }
.kpi-card:nth-child(3) { animation-delay: 0.15s; }
.kpi-card:nth-child(4) { animation-delay: 0.20s; }
.kpi-card:nth-child(5) { animation-delay: 0.25s; }
.kpi-card:nth-child(6) { animation-delay: 0.30s; }

::-webkit-scrollbar { width: 3px; height: 3px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--surface-3); border-radius: 2px; }

/* ‚îÄ‚îÄ HAMBURGER MENU ‚îÄ‚îÄ */
.sidebar-toggle {
  display: none;
  flex-direction: column;
  background: none;
  border: none;
  cursor: pointer;
  gap: 4px;
  padding: 8px;
  position: fixed;
  top: 8px;
  left: 8px;
  z-index: 102;
}

.sidebar-toggle span {
  width: 20px;
  height: 2px;
  background: var(--cream);
  border-radius: 1px;
  transition: all 0.3s ease;
}

.sidebar-toggle.active span:nth-child(1) {
  transform: rotate(45deg) translateY(9px);
}

.sidebar-toggle.active span:nth-child(2) {
  opacity: 0;
}

.sidebar-toggle.active span:nth-child(3) {
  transform: rotate(-45deg) translateY(-9px);
}

/* ‚îÄ‚îÄ RESPONSIVE DASHBOARD ‚îÄ‚îÄ */
@media (max-width: 1200px) {
  .content {
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .kpi-row {
    grid-template-columns: repeat(3, 1fr);
  }

  .heatmap-card,
  .sparkline-row,
  .pipeline-card {
    grid-column: 1 / -1;
  }

  .sparkline-row {
    grid-template-columns: 1fr 1fr;
  }

  .agents-card {
    grid-column: auto;
  }

  .alerts-card {
    grid-column: 1 / -1;
    grid-row: auto;
  }

  .alerts-body {
    max-height: 300px;
  }

  #intel-panel {
    width: 360px;
  }
}

@media (max-width: 900px) {
  body {
    flex-direction: column;
  }

  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    height: 100%;
    width: 220px;
    z-index: 99;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    box-shadow: 2px 0 16px rgba(0, 0, 0, 0.3);
  }

  .sidebar.active {
    transform: translateX(0);
  }

  .sidebar-toggle {
    display: flex;
  }

  .main {
    flex: 1;
    width: 100%;
  }

  .content {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .kpi-row {
    grid-template-columns: repeat(2, 1fr);
  }

  .heatmap-card,
  .sparkline-row,
  .pipeline-card,
  .agents-card,
  .alerts-card {
    grid-column: 1 / -1;
    grid-row: auto;
  }

  .sparkline-row {
    grid-template-columns: 1fr;
  }

  .alerts-body {
    max-height: 300px;
  }

  .cat-grid {
    grid-template-columns: 1fr;
  }

  #intel-panel {
    width: 100%;
  }

  .pipeline-body {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .pipeline-table {
    min-width: 700px;
  }

  .onboarding-modal {
    width: 95vw;
    max-width: 95vw;
  }

  .ob-features {
    grid-template-columns: 1fr;
  }

  .ob-agent-grid {
    grid-template-columns: 1fr;
  }

  .topbar {
    height: auto;
    flex-wrap: wrap;
    gap: 12px;
    padding: 12px 16px;
  }

  .topbar-title {
    font-size: 16px;
  }

  .topbar-right {
    width: 100%;
    margin-left: 0;
  }

  html, body {
    height: auto;
    overflow: auto;
  }

  body {
    height: auto;
    min-height: 100vh;
  }

  .main {
    overflow: visible;
    height: auto;
  }

  .content {
    overflow: visible;
    height: auto;
  }
}

@media (max-width: 600px) {
  .sidebar-toggle {
    top: 12px;
    left: 12px;
  }

  .sidebar {
    width: 100%;
  }

  .content {
    grid-template-columns: 1fr;
    padding: 12px 16px 16px;
    gap: 10px;
  }

  .kpi-row {
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }

  .kpi-label {
    font-size: 6px;
  }

  .kpi-value {
    font-size: 24px;
  }

  .card {
    border-radius: 4px;
  }

  .card-header {
    padding: 10px 12px 0;
  }

  .card-title {
    font-size: 8px;
  }

  .topbar {
    padding: 10px 12px;
    height: auto;
  }

  .topbar-title {
    font-size: 14px;
  }

  .topbar-date {
    font-size: 8px;
  }

  .topbar-right {
    flex-direction: column;
    width: 100%;
  }

  .add-intel-btn {
    font-size: 11px;
    padding: 6px 12px;
    width: 100%;
    justify-content: center;
  }

  .ob-modal {
    width: 95vw;
    max-width: 95vw;
  }

  .heatmap-grid {
    grid-template-columns: repeat(3, 1fr);
  }

  .ob-body {
    padding: 20px 16px;
  }

  .ob-header {
    padding: 20px 16px 0;
  }

  .ob-footer {
    padding: 16px;
  }

  .ob-progress {
    margin: 16px 16px 0;
  }

  .panel-header {
    padding: 16px 16px 14px;
  }

  .panel-body {
    padding: 16px;
  }
}
</style>
</head>
<body>

<!-- Sidebar Toggle Button -->
<button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
  <span></span>
  <span></span>
  <span></span>
</button>

<!-- ‚ïê‚ïê ONBOARDING OVERLAY ‚ïê‚ïê -->
<div id="onboarding-overlay">
  <div class="onboarding-modal" id="ob-modal">
    <div class="ob-header">
      <div>
        <div class="ob-logo">Land<span>Marq</span></div>
        <div class="ob-step-counter" id="ob-counter">Step 1 of 5</div>
      </div>
    </div>
    <div class="ob-progress"><div class="ob-progress-fill" id="ob-progress" style="width:20%"></div></div>

    <div class="ob-body">

      <!-- STEP 1: Welcome -->
      <div class="ob-step active" id="ob-step-1">
        <span class="ob-step-icon">üèõÔ∏è</span>
        <div class="ob-step-title">Welcome to <em>LandMarq</em></div>
        <div class="ob-step-desc">Your personal AI intelligence platform for commercial real estate. LandMarq deploys a fleet of specialized agents that monitor markets, surface leads, and flag opportunities ‚Äî all delivered to a single executive dashboard, every morning.</div>
        <div class="ob-features">
          <div class="ob-feature"><div class="ob-feature-icon">üåê</div><div class="ob-feature-text"><strong>Market Intelligence</strong>Submarket vacancy, rents, permit filings, competitor moves.</div></div>
          <div class="ob-feature"><div class="ob-feature-icon">üéØ</div><div class="ob-feature-text"><strong>Tenant Lead Engine</strong>LLC filings, job postings, lease expirations ‚Äî found before the RFP.</div></div>
          <div class="ob-feature"><div class="ob-feature-icon">üìã</div><div class="ob-feature-text"><strong>Document Review</strong>LOI clause flagging, NDA drafting, vs. your gold standard template.</div></div>
          <div class="ob-feature"><div class="ob-feature-icon">üì°</div><div class="ob-feature-text"><strong>Zoning & Permits</strong>Real-time government portal monitoring across all your markets.</div></div>
        </div>
      </div>

      <!-- STEP 2: Profile Setup -->
      <div class="ob-step" id="ob-step-2">
        <span class="ob-step-icon">üë§</span>
        <div class="ob-step-title">Set up your <em>profile</em></div>
        <div class="ob-step-desc">This helps LandMarq personalize your briefings and filter intelligence to what's relevant to your role and focus areas.</div>
        <div class="ob-input-group">
          <label class="ob-label">Your Name</label>
          <input class="ob-input" id="ob-name" type="text" placeholder="e.g. Mark Sullivan" />
        </div>
        <div class="ob-input-group">
          <label class="ob-label">Firm</label>
          <input class="ob-input" type="text" placeholder="e.g. Savills North America" />
        </div>
        <div class="ob-input-group">
          <label class="ob-label">Your Role / Focus</label>
          <div style="display:flex;gap:8px;">
            <input class="ob-input" type="text" placeholder="Title" style="flex:1" />
            <input class="ob-input" type="text" placeholder="Specialty" style="flex:1" />
          </div>
        </div>
      </div>

      <!-- STEP 3: Markets -->
      <div class="ob-step" id="ob-step-3">
        <span class="ob-step-icon">üìç</span>
        <div class="ob-step-title">Choose your <em>markets</em></div>
        <div class="ob-step-desc">Select the submarkets you want LandMarq to monitor. You can add zip codes and area codes, or pick from major metros. You can always change these later.</div>
        <div class="ob-chips-row" id="market-chips">
          <div class="ob-chip selected" onclick="toggleChip(this)">Los Angeles</div>
          <div class="ob-chip selected" onclick="toggleChip(this)">Santa Monica</div>
          <div class="ob-chip selected" onclick="toggleChip(this)">Culver City</div>
          <div class="ob-chip selected" onclick="toggleChip(this)">Century City</div>
          <div class="ob-chip" onclick="toggleChip(this)">San Francisco</div>
          <div class="ob-chip" onclick="toggleChip(this)">Seattle</div>
          <div class="ob-chip selected" onclick="toggleChip(this)">Playa Vista</div>
          <div class="ob-chip" onclick="toggleChip(this)">Burbank</div>
          <div class="ob-chip" onclick="toggleChip(this)">El Segundo</div>
          <div class="ob-chip" onclick="toggleChip(this)">Manhattan Beach</div>
          <div class="ob-chip" onclick="toggleChip(this)">West Hollywood</div>
          <div class="ob-chip" onclick="toggleChip(this)">DTLA</div>
        </div>
        <div style="margin-top:14px;">
          <label class="ob-label">Or add a specific ZIP / Area Code</label>
          <div style="display:flex;gap:8px;">
            <input class="ob-input" id="market-zip-input" type="text" placeholder="e.g. 90401, Phoenix, 90064..." style="flex:1;" onkeydown="if(event.key==='Enter'){addMarketChip();}" />
            <button onclick="addMarketChip()" style="background:var(--gold);color:var(--bg);border:none;border-radius:4px;padding:0 16px;font-family:'Syne',sans-serif;font-size:12px;font-weight:600;cursor:pointer;">Add</button>
          </div>
        </div>
      </div>

      <!-- STEP 4: Agents -->
      <div class="ob-step" id="ob-step-4">
        <span class="ob-step-icon">‚öôÔ∏è</span>
        <div class="ob-step-title">Activate your <em>agents</em></div>
        <div class="ob-step-desc">Each agent runs continuously in the background. Toggle on the ones relevant to your day-to-day. You can adjust anytime.</div>
        <div class="ob-agent-grid">
          <div class="ob-agent-toggle on" onclick="this.classList.toggle('on')">
            <div class="toggle-icon">üåê</div>
            <div class="toggle-info"><div class="toggle-name">Market Intel</div><div class="toggle-desc">Vacancy, rents, comps</div></div>
            <div class="toggle-dot"></div>
          </div>
          <div class="ob-agent-toggle on" onclick="this.classList.toggle('on')">
            <div class="toggle-icon">üéØ</div>
            <div class="toggle-info"><div class="toggle-name">Lead Finder</div><div class="toggle-desc">Tenant expansion signals</div></div>
            <div class="toggle-dot"></div>
          </div>
          <div class="ob-agent-toggle on" onclick="this.classList.toggle('on')">
            <div class="toggle-icon">üìã</div>
            <div class="toggle-info"><div class="toggle-name">LOI Review</div><div class="toggle-desc">Clause flagging</div></div>
            <div class="toggle-dot"></div>
          </div>
          <div class="ob-agent-toggle" onclick="this.classList.toggle('on')">
            <div class="toggle-icon">‚úâÔ∏è</div>
            <div class="toggle-info"><div class="toggle-name">Outreach</div><div class="toggle-desc">Personalized pitches</div></div>
            <div class="toggle-dot"></div>
          </div>
          <div class="ob-agent-toggle on" onclick="this.classList.toggle('on')">
            <div class="toggle-icon">üì°</div>
            <div class="toggle-info"><div class="toggle-name">Zoning Monitor</div><div class="toggle-desc">Permits & variances</div></div>
            <div class="toggle-dot"></div>
          </div>
          <div class="ob-agent-toggle" onclick="this.classList.toggle('on')">
            <div class="toggle-icon">üèõÔ∏è</div>
            <div class="toggle-info"><div class="toggle-name">Portfolio Analyst</div><div class="toggle-desc">Hold vs. sell analysis</div></div>
            <div class="toggle-dot"></div>
          </div>
        </div>
      </div>

      <!-- STEP 5: Ready -->
      <div class="ob-step" id="ob-step-5">
        <span class="ob-step-icon" style="font-size:42px;display:inline-flex;align-items:center;justify-content:center;width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,var(--gold),#B08A3E);color:#0A0C0E;font-family:'Syne',sans-serif;font-weight:700;line-height:1;">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#0A0C0E" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        </span>
        <div class="ob-step-title">You're all set<em id="welcome-name"></em>.</div>
        <div class="ob-step-desc">Your agents are now running across your selected markets. Your first morning brief will be ready within minutes. As you use the dashboard, click <strong style="color:var(--gold);">+ Add Intelligence</strong> anytime to configure new watches ‚Äî just tell us in plain English what you want to track.</div>
        <div class="ob-features">
          <div class="ob-feature"><div class="ob-feature-icon">üí¨</div><div class="ob-feature-text"><strong>Natural Language</strong>"Show me CRE growth projections in 310 area for tech tenants" ‚Äî just type it.</div></div>
          <div class="ob-feature"><div class="ob-feature-icon">üîî</div><div class="ob-feature-text"><strong>Custom Alerts</strong>Set thresholds for vacancy %, interest rate changes, specific submarkets.</div></div>
          <div class="ob-feature"><div class="ob-feature-icon">üìä</div><div class="ob-feature-text"><strong>Daily Brief</strong>Curated to your markets and role. Delivered 6 AM sharp.</div></div>
          <div class="ob-feature"><div class="ob-feature-icon">üîç</div><div class="ob-feature-text"><strong>Guided Tour</strong>After this, we'll highlight each part of your dashboard.</div></div>
        </div>
      </div>

    </div>

    <div class="ob-footer">
      <button class="ob-btn-skip" onclick="skipOnboarding()">Skip Tour</button>
      <button class="ob-btn-next" id="ob-next-btn" onclick="nextStep()">
        <span id="ob-btn-label">Get Started</span> ‚Üí
      </button>
    </div>
  </div>
</div>

<!-- SPOTLIGHT RING -->
<div class="spotlight-ring" id="spotlight-ring"></div>

<!-- SPOTLIGHT TOOLTIP -->
<div class="spotlight-tooltip" id="spotlight-tooltip">
  <div class="tooltip-step" id="tt-step">Tour ¬∑ 1 of 5</div>
  <div class="tooltip-title" id="tt-title">Title</div>
  <div class="tooltip-desc" id="tt-desc">Description</div>
  <div class="tooltip-nav">
    <div class="tooltip-close" onclick="endTour()">End Tour</div>
    <button class="tooltip-nav-btn" id="tt-next-btn" onclick="nextTourStep()">Next ‚Üí</button>
  </div>
</div>

<!-- ‚ïê‚ïê SIDEBAR ‚ïê‚ïê -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <div class="logo-wordmark"><span class="lm-land">Land</span><span class="lm-marq">Marq</span></div>
    <div class="logo-sub">Executive Intelligence ¬∑ ai</div>
  </div>

  <div class="user-card" id="nav-profile">
    <div class="user-avatar">‚Äî</div>
    <div>
      <div class="user-name">Your Profile</div>
      <div class="user-title">Complete onboarding to set up</div>
    </div>
  </div>

  <div class="nav-section">
    <div class="nav-label">Workspace</div>
    <div class="nav-item active" id="nav-brief">
      <span class="nav-icon">‚óà</span> Morning Brief
    </div>
    <div class="nav-item" id="nav-agents">
      <span class="nav-icon">‚¨°</span> Agent Fleet
      <span class="nav-badge green">6</span>
    </div>
    <div class="nav-item" id="nav-pipeline">
      <span class="nav-icon">‚óé</span> Deal Pipeline
      <span class="nav-badge gold">14</span>
    </div>
    <div class="nav-item">
      <span class="nav-icon">‚ñ≥</span> Market Intel
    </div>
    <div class="nav-item" id="nav-leads">
      <span class="nav-icon">‚óª</span> Tenant Leads
      <span class="nav-badge">3</span>
    </div>
  </div>

  <div class="nav-section">
    <div class="nav-label">Reports</div>
    <div class="nav-item"><span class="nav-icon">‚â°</span> West Coast Markets</div>
    <div class="nav-item"><span class="nav-icon">‚ó∑</span> Submarket Tracker</div>
    <div class="nav-item"><span class="nav-icon">‚äï</span> Portfolio Analysis</div>
  </div>

  <div class="nav-section">
    <div class="nav-label">Settings</div>
    <div class="nav-item"><span class="nav-icon">‚öô</span> Preferences</div>
    <div class="nav-item"><span class="nav-icon">‚ó∑</span> Brief Schedule</div>
    <div class="nav-item" onclick="LandMarqAuth.signOut()" style="cursor:pointer;color:var(--text-dim);">
      <span class="nav-icon">‚Ü©</span> Sign Out
    </div>
  </div>

  <div class="sidebar-footer">
    <div class="status-indicator"><div class="pulse-dot"></div><div class="status-text">6 agents active</div></div>
  </div>
</div>

<!-- ‚ïê‚ïê MAIN ‚ïê‚ïê -->
<div class="main">
  <div class="topbar" id="topbar">
    <div class="topbar-title">Morning Brief</div>
    <div class="topbar-date" id="topbar-date"></div>
    <div class="topbar-right">
      <div class="topbar-chip"><div class="pulse-dot" style="background:var(--gold);animation:pulseGold 2s ease-in-out infinite;width:6px;height:6px;border-radius:50%;"></div>&nbsp;Agents Running</div>
      <button class="add-intel-btn" id="add-intel-btn" onclick="openIntelPanel()">+ Add Intelligence</button>
      <div class="icon-btn">üîî</div>
      <div class="icon-btn">‚öô</div>
    </div>
  </div>

  <div class="content">

    <!-- KPI ROW -->
    <div class="kpi-row" id="kpi-row">
      <div class="kpi-card"><div class="kpi-label">Total Pipeline Value</div><div class="kpi-value gold">$218M</div><div class="kpi-delta delta-up">‚ñ≤ 12.4% <span class="kpi-sub">vs last quarter</span></div></div>
      <div class="kpi-card"><div class="kpi-label">Active Deals</div><div class="kpi-value">14</div><div class="kpi-delta delta-up">‚ñ≤ 3 <span class="kpi-sub">this month</span></div></div>
      <div class="kpi-card"><div class="kpi-label">Avg. LA Office Vacancy</div><div class="kpi-value">14.2%</div><div class="kpi-delta delta-down">‚ñº 0.8% <span class="kpi-sub">90-day trend</span></div></div>
      <div class="kpi-card"><div class="kpi-label">Agent-Sourced Leads (30d)</div><div class="kpi-value">31</div><div class="kpi-delta delta-up">‚ñ≤ 8 <span class="kpi-sub">this month</span></div></div>
      <div class="kpi-card"><div class="kpi-label">Avg. NNN PSF ¬∑ SF</div><div class="kpi-value">$62</div><div class="kpi-delta delta-up">‚ñ≤ $1.20 <span class="kpi-sub">MoM</span></div></div>
      <div class="kpi-card"><div class="kpi-label">Unread Alerts</div><div class="kpi-value">7</div><div class="kpi-delta delta-neutral">‚¨§ <span class="kpi-sub">3 high priority</span></div></div>
    </div>

    <!-- HEATMAP -->
    <div class="card heatmap-card" id="heatmap-card">
      <div class="card-header"><div class="card-title">West Coast Submarket Pulse</div><div class="card-action">Full Map ‚Üí</div></div>
      <div class="heatmap-body">
        <div class="heatmap-grid">
          <div class="heatmap-cell" style="background:rgba(192,83,58,0.55)"><div class="heat-market">DTLA</div><div class="heat-val">18.4%</div></div>
          <div class="heatmap-cell" style="background:rgba(196,158,84,0.45)"><div class="heat-market">Culver City</div><div class="heat-val">11.2%</div></div>
          <div class="heatmap-cell" style="background:rgba(74,127,165,0.5)"><div class="heat-market">Santa Monica</div><div class="heat-val">9.8%</div></div>
          <div class="heatmap-cell" style="background:rgba(74,127,165,0.35)"><div class="heat-market">Playa Vista</div><div class="heat-val">8.1%</div></div>
          <div class="heatmap-cell" style="background:rgba(74,155,111,0.45)"><div class="heat-market">El Segundo</div><div class="heat-val">6.7%</div></div>
          <div class="heatmap-cell" style="background:rgba(196,158,84,0.35)"><div class="heat-market">Century City</div><div class="heat-val">12.6%</div></div>
          <div class="heatmap-cell" style="background:rgba(74,155,111,0.35)"><div class="heat-market">West Hollywood</div><div class="heat-val">7.3%</div></div>
          <div class="heatmap-cell" style="background:rgba(192,83,58,0.4)"><div class="heat-market">Wilshire Corridor</div><div class="heat-val">16.1%</div></div>
          <div class="heatmap-cell" style="background:rgba(74,127,165,0.42)"><div class="heat-market">Burbank</div><div class="heat-val">10.4%</div></div>
          <div class="heatmap-cell" style="background:rgba(74,155,111,0.5)"><div class="heat-market">Manhattan Bch</div><div class="heat-val">5.9%</div></div>
          <div class="heatmap-cell" style="background:rgba(192,83,58,0.65)"><div class="heat-market">SF Financial</div><div class="heat-val">26.3%</div></div>
          <div class="heatmap-cell" style="background:rgba(192,83,58,0.45)"><div class="heat-market">SF SOMA</div><div class="heat-val">22.1%</div></div>
          <div class="heatmap-cell" style="background:rgba(74,127,165,0.4)"><div class="heat-market">SF Mission</div><div class="heat-val">14.8%</div></div>
          <div class="heatmap-cell" style="background:rgba(74,155,111,0.45)"><div class="heat-market">Bellevue WA</div><div class="heat-val">9.2%</div></div>
          <div class="heatmap-cell" style="background:rgba(74,127,165,0.38)"><div class="heat-market">Seattle SLU</div><div class="heat-val">11.0%</div></div>
        </div>
        <div style="display:flex;gap:16px;align-items:center;margin-top:9px;">
          <div style="font-family:'JetBrains Mono',monospace;font-size:7px;color:var(--text-dim);letter-spacing:0.12em;">VACANCY:</div>
          <div style="display:flex;gap:12px;">
            <div style="display:flex;gap:5px;align-items:center;"><div style="width:20px;height:5px;border-radius:1px;background:rgba(74,155,111,0.5)"></div><span style="font-family:'JetBrains Mono',monospace;font-size:7px;color:var(--text-dim)">&lt;10%</span></div>
            <div style="display:flex;gap:5px;align-items:center;"><div style="width:20px;height:5px;border-radius:1px;background:rgba(74,127,165,0.5)"></div><span style="font-family:'JetBrains Mono',monospace;font-size:7px;color:var(--text-dim)">10‚Äì15%</span></div>
            <div style="display:flex;gap:5px;align-items:center;"><div style="width:20px;height:5px;border-radius:1px;background:rgba(196,158,84,0.5)"></div><span style="font-family:'JetBrains Mono',monospace;font-size:7px;color:var(--text-dim)">15‚Äì20%</span></div>
            <div style="display:flex;gap:5px;align-items:center;"><div style="width:20px;height:5px;border-radius:1px;background:rgba(192,83,58,0.6)"></div><span style="font-family:'JetBrains Mono',monospace;font-size:7px;color:var(--text-dim)">&gt;20%</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- AGENT FEED -->
    <div class="card agents-card" id="agent-card">
      <div class="card-header"><div class="card-title">Live Agent Feed</div><div class="card-action">View All ‚Üí</div></div>
      <div class="agent-stream" id="agentStream">
        <div class="stream-item"><div class="stream-icon icon-alert">‚ö°</div><div><div class="stream-text"><strong>Snap Inc.</strong> vacating 42K SF at 2101 Colorado Ave SM ‚Äî 3 tenants circling.</div><div class="stream-meta"><span class="stream-tag tag-alert">High Priority</span> 2 min ago ¬∑ Intel Agent</div></div></div>
        <div class="stream-item"><div class="stream-icon icon-lead">üéØ</div><div><div class="stream-text"><strong>TechCo Inc.</strong> (Series C) posted 40+ LA jobs. Office expansion signal.</div><div class="stream-meta"><span class="stream-tag tag-lead">New Lead</span> 14 min ago ¬∑ Lead Agent</div></div></div>
        <div class="stream-item"><div class="stream-icon icon-doc">üìã</div><div><div class="stream-text"><strong>LOI Agent</strong> flagged non-standard exclusivity clause ‚Äî Apex Capital draft.</div><div class="stream-meta"><span class="stream-tag tag-doc">Document</span> 31 min ago ¬∑ LOI Agent</div></div></div>
        <div class="stream-item"><div class="stream-icon icon-intel">üîç</div><div><div class="stream-text">Zoning variance filed for <strong>1150 S Olive St</strong> ‚Äî mixed-use conversion.</div><div class="stream-meta"><span class="stream-tag tag-intel">Zoning</span> 1 hr ago ¬∑ Permit Agent</div></div></div>
        <div class="stream-item"><div class="stream-icon icon-lead">‚úâÔ∏è</div><div><div class="stream-text"><strong>Outreach Agent</strong> drafting personalized pitch for Netflix HQ expansion&nbsp;<span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></div><div class="stream-meta"><span class="stream-tag tag-lead">In Progress</span> now ¬∑ Outreach Agent</div></div></div>
      </div>
    </div>

    <!-- ALERTS (right column spans rows) -->
    <div class="card alerts-card" id="alerts-card">
      <div class="card-header"><div class="card-title">Priority Alerts</div><div class="card-action">Mark All Read</div></div>
      <div class="alerts-body">
        <div class="alert-item alert-high"><div class="alert-priority">‚óè High Priority</div><div class="alert-title">Snap vacating 42K SF ‚Äî Santa Monica</div><div class="alert-body">Lease expires Q2. 3 TAMI tenants in same submarket searching. First-mover window: ~6 weeks.</div><div class="alert-footer"><div class="alert-agent">Intel Agent</div><div class="alert-time">2m ago</div></div><div class="alert-action-btn">Draft Outreach ‚Üí</div></div>
        <div class="alert-item alert-high"><div class="alert-priority">‚óè High Priority</div><div class="alert-title">LOI Clause Mismatch ‚Äî Apex Capital</div><div class="alert-body">Non-standard "co-tenancy" clause on Sections 4.2 & 7. Differs from Savills gold template.</div><div class="alert-footer"><div class="alert-agent">LOI Agent</div><div class="alert-time">31m ago</div></div><div class="alert-action-btn">Review Comparison ‚Üí</div></div>
        <div class="alert-item alert-med"><div class="alert-priority">‚óÜ Medium</div><div class="alert-title">TechCo Inc. Expansion Signal</div><div class="alert-body">40+ LA job postings. Badge-in at current WeWork up 62%. Likely seeking 15‚Äì25K SF.</div><div class="alert-footer"><div class="alert-agent">Lead Agent</div><div class="alert-time">14m ago</div></div><div class="alert-action-btn">View Lead Profile ‚Üí</div></div>
        <div class="alert-item alert-med"><div class="alert-priority">‚óÜ Medium</div><div class="alert-title">Interest Rate Watch Triggered</div><div class="alert-body">Fed signals pause. Model projects cap rate compression in industrial by 25bps over 90 days.</div><div class="alert-footer"><div class="alert-agent">Macro Agent</div><div class="alert-time">1h ago</div></div><div class="alert-action-btn">View Impact Report ‚Üí</div></div>
        <div class="alert-item alert-low"><div class="alert-priority">‚ñ∏ Intel Update</div><div class="alert-title">Playa Vista Occupancy Up</div><div class="alert-body">Badge-in data: Playa Vista 74% vs. 61% DTLA avg. Tenant preference shifting toward submarket.</div><div class="alert-footer"><div class="alert-agent">Intel Agent</div><div class="alert-time">4h ago</div></div></div>
        <div class="alert-item alert-low"><div class="alert-priority">‚ñ∏ Intel Update</div><div class="alert-title">CBRE Deal Closed ‚Äî Water Garden</div><div class="alert-body">18,500 SF closed. 3 remaining comparable availabilities in SM. Market tightening.</div><div class="alert-footer"><div class="alert-agent">Intel Agent</div><div class="alert-time">2h ago</div></div></div>
      </div>
    </div>

    <!-- SPARKLINES -->
    <div class="sparkline-row">
      <div class="card spark-card">
        <div class="card-header"><div class="card-title">Deal Value ¬∑ Q1 2026</div></div>
        <div class="spark-body"><div class="spark-stat"><div class="spark-big">$218M</div><div class="spark-delta delta-up">‚ñ≤ 12.4%</div></div><div class="spark-main"><div class="spark-bar gold-bar" style="height:45%"></div><div class="spark-bar gold-bar" style="height:60%"></div><div class="spark-bar gold-bar" style="height:50%"></div><div class="spark-bar gold-bar" style="height:70%"></div><div class="spark-bar gold-bar" style="height:55%"></div><div class="spark-bar gold-bar" style="height:80%"></div><div class="spark-bar gold-bar" style="height:65%"></div><div class="spark-bar gold-bar" style="height:88%"></div><div class="spark-bar gold-bar" style="height:72%"></div><div class="spark-bar gold-bar" style="height:90%"></div><div class="spark-bar gold-bar" style="height:84%"></div><div class="spark-bar gold-bar current" style="height:100%"></div></div><div class="spark-labels"><span class="spark-label">Feb '25</span><span class="spark-label">Aug '25</span><span class="spark-label">Feb '26</span></div></div>
      </div>
      <div class="card spark-card">
        <div class="card-header"><div class="card-title">Agent-Sourced Leads ¬∑ 12mo</div></div>
        <div class="spark-body"><div class="spark-stat"><div class="spark-big">31</div><div class="spark-delta delta-up">‚ñ≤ 8 this month</div></div><div class="spark-main"><div class="spark-bar green-bar" style="height:30%"></div><div class="spark-bar green-bar" style="height:40%"></div><div class="spark-bar green-bar" style="height:35%"></div><div class="spark-bar green-bar" style="height:55%"></div><div class="spark-bar green-bar" style="height:48%"></div><div class="spark-bar green-bar" style="height:62%"></div><div class="spark-bar green-bar" style="height:70%"></div><div class="spark-bar green-bar" style="height:60%"></div><div class="spark-bar green-bar" style="height:78%"></div><div class="spark-bar green-bar" style="height:85%"></div><div class="spark-bar green-bar" style="height:90%"></div><div class="spark-bar green-bar current" style="height:100%"></div></div><div class="spark-labels"><span class="spark-label">Feb '25</span><span class="spark-label">Aug '25</span><span class="spark-label">Feb '26</span></div></div>
      </div>
      <div class="card spark-card">
        <div class="card-header"><div class="card-title">Vacancy Rate ¬∑ LA Metro</div></div>
        <div class="spark-body"><div class="spark-stat"><div class="spark-big">14.2%</div><div class="spark-delta delta-down">‚ñº 0.8% (90d)</div></div><div class="spark-main"><div class="spark-bar blue-bar" style="height:100%"></div><div class="spark-bar blue-bar" style="height:96%"></div><div class="spark-bar blue-bar" style="height:92%"></div><div class="spark-bar blue-bar" style="height:98%"></div><div class="spark-bar blue-bar" style="height:88%"></div><div class="spark-bar blue-bar" style="height:85%"></div><div class="spark-bar blue-bar" style="height:82%"></div><div class="spark-bar blue-bar" style="height:78%"></div><div class="spark-bar blue-bar" style="height:80%"></div><div class="spark-bar blue-bar" style="height:74%"></div><div class="spark-bar blue-bar" style="height:70%"></div><div class="spark-bar blue-bar current" style="height:66%"></div></div><div class="spark-labels"><span class="spark-label">Feb '25</span><span class="spark-label">Aug '25</span><span class="spark-label">Feb '26</span></div></div>
      </div>
    </div>

    <!-- PIPELINE TABLE -->
    <div class="card pipeline-card" id="pipeline-card">
      <div class="card-header"><div class="card-title">Active Deal Pipeline</div><div style="display:flex;gap:12px;align-items:center;"><button class="add-deal-btn" id="add-deal-btn" onclick="openAddDealModal()">+ Add Deal</button><div class="card-action">View All 14 Deals ‚Üí</div></div></div>
      <div class="pipeline-body">
        <table class="pipeline-table">
          <thead><tr><th>Tenant</th><th>Market</th><th>SF</th><th>Value</th><th>Stage</th><th>Probability</th><th>Close</th><th></th></tr></thead>
          <tbody>
            <tr><td><div class="tenant-name">Netflix Inc.</div><div class="tenant-sub">HQ Expansion ¬∑ TAMI</div></td><td><span class="market-tag">Culver City</span></td><td><span class="size-val">~60K</span></td><td><span class="value-cell">$42M</span></td><td><span class="stage-pill stage-proposal">Proposal</span></td><td><div class="prob-bar-wrap"><div class="prob-bar-bg"><div class="prob-bar-fill green" style="width:72%"></div></div><span class="prob-val">72%</span></div></td><td style="font-family:'JetBrains Mono',monospace;font-size:8.5px;color:var(--text-mid)">Apr '26</td><td><div class="action-dots"><span></span><span></span><span></span></div></td></tr>
            <tr><td><div class="tenant-name">Apex Capital Group</div><div class="tenant-sub">Relocation ¬∑ Financial</div></td><td><span class="market-tag">Century City</span></td><td><span class="size-val">28,500</span></td><td><span class="value-cell">$19M</span></td><td><span class="stage-pill stage-loi">LOI Signed</span></td><td><div class="prob-bar-wrap"><div class="prob-bar-bg"><div class="prob-bar-fill green" style="width:88%"></div></div><span class="prob-val">88%</span></div></td><td style="font-family:'JetBrains Mono',monospace;font-size:8.5px;color:var(--text-mid)">Mar '26</td><td><div class="action-dots"><span></span><span></span><span></span></div></td></tr>
            <tr><td><div class="tenant-name">TechCo Inc.</div><div class="tenant-sub">New Requirement ¬∑ SaaS</div></td><td><span class="market-tag">Playa Vista</span></td><td><span class="size-val">~20K</span></td><td><span class="value-cell">$11M</span></td><td><span class="stage-pill stage-qualify">Qualifying</span></td><td><div class="prob-bar-wrap"><div class="prob-bar-bg"><div class="prob-bar-fill amber" style="width:38%"></div></div><span class="prob-val">38%</span></div></td><td style="font-family:'JetBrains Mono',monospace;font-size:8.5px;color:var(--text-mid)">Q3 '26</td><td><div class="action-dots"><span></span><span></span><span></span></div></td></tr>
            <tr><td><div class="tenant-name">WestShore Media</div><div class="tenant-sub">Expansion ¬∑ Media</div></td><td><span class="market-tag">Santa Monica</span></td><td><span class="size-val">14,200</span></td><td><span class="value-cell">$8.5M</span></td><td><span class="stage-pill stage-proposal">Proposal</span></td><td><div class="prob-bar-wrap"><div class="prob-bar-bg"><div class="prob-bar-fill" style="width:61%"></div></div><span class="prob-val">61%</span></div></td><td style="font-family:'JetBrains Mono',monospace;font-size:8.5px;color:var(--text-mid)">May '26</td><td><div class="action-dots"><span></span><span></span><span></span></div></td></tr>
            <tr><td><div class="tenant-name">Meridian Health Partners</div><div class="tenant-sub">New Requirement ¬∑ Healthcare</div></td><td><span class="market-tag">Burbank</span></td><td><span class="size-val">9,000</span></td><td><span class="value-cell">$4.2M</span></td><td><span class="stage-pill stage-prospect">Prospect</span></td><td><div class="prob-bar-wrap"><div class="prob-bar-bg"><div class="prob-bar-fill blue" style="width:24%"></div></div><span class="prob-val">24%</span></div></td><td style="font-family:'JetBrains Mono',monospace;font-size:8.5px;color:var(--text-mid)">Q4 '26</td><td><div class="action-dots"><span></span><span></span><span></span></div></td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main -->

<!-- ‚ïê‚ïê ADD INTELLIGENCE PANEL ‚ïê‚ïê -->
<div id="intel-panel">
  <div class="panel-header">
    <div>
      <div class="panel-title">Add Intelligence</div>
      <div class="panel-sub">Tell us what you want to watch</div>
    </div>
    <div class="panel-close" onclick="closeIntelPanel()">‚úï</div>
  </div>

  <div class="panel-body">

    <!-- Natural Language Input -->
    <div class="panel-section">
      <div class="panel-section-title">Tell us what you want</div>
      <div class="nlp-input-wrap">
        <textarea class="nlp-input" id="nlp-input" placeholder="e.g. Show me CRE growth projections in the 310 area for tech tenants over the next 12 months..."></textarea>
        <button class="nlp-send-btn" onclick="submitNLP()">‚Üí</button>
      </div>
      <div class="nlp-suggestions">
        <div class="nlp-suggestion" onclick="fillNLP(this)">I want updates on commercial real estate in area code 310</div>
        <div class="nlp-suggestion" onclick="fillNLP(this)">Show me how interest rate changes will impact CRE industries differently</div>
        <div class="nlp-suggestion" onclick="fillNLP(this)">Track CRE growth projections in LA for healthcare and tech tenants</div>
        <div class="nlp-suggestion" onclick="fillNLP(this)">Alert me when any office vacancy in Santa Monica drops below 8%</div>
      </div>
    </div>

    <!-- Category Selector -->
    <div class="panel-section">
      <div class="panel-section-title">Or choose a category</div>
      <div class="cat-grid">
        <div class="cat-btn active" onclick="selectCat(this)">
          <div class="cat-btn-icon">üìç</div>
          <div class="cat-btn-info"><div class="cat-btn-name">By Area / ZIP</div><div class="cat-btn-desc">Track a specific geography</div></div>
        </div>
        <div class="cat-btn" onclick="selectCat(this)">
          <div class="cat-btn-icon">üè≠</div>
          <div class="cat-btn-info"><div class="cat-btn-name">By Industry</div><div class="cat-btn-desc">Tech, healthcare, finance...</div></div>
        </div>
        <div class="cat-btn" onclick="selectCat(this)">
          <div class="cat-btn-icon">üìà</div>
          <div class="cat-btn-info"><div class="cat-btn-name">Macro Signal</div><div class="cat-btn-desc">Rates, inflation, cap rates</div></div>
        </div>
        <div class="cat-btn" onclick="selectCat(this)">
          <div class="cat-btn-icon">üè¢</div>
          <div class="cat-btn-info"><div class="cat-btn-name">Property Type</div><div class="cat-btn-desc">Office, industrial, retail...</div></div>
        </div>
        <div class="cat-btn" onclick="selectCat(this)">
          <div class="cat-btn-icon">üéØ</div>
          <div class="cat-btn-info"><div class="cat-btn-name">Tenant Watch</div><div class="cat-btn-desc">Track specific companies</div></div>
        </div>
        <div class="cat-btn" onclick="selectCat(this)">
          <div class="cat-btn-icon">‚öñÔ∏è</div>
          <div class="cat-btn-info"><div class="cat-btn-name">Regulatory</div><div class="cat-btn-desc">Zoning, permits, variances</div></div>
        </div>
      </div>
    </div>

    <!-- Configuration fields -->
    <div class="panel-section">
      <div class="panel-section-title">Configure</div>
      <div class="panel-row">
        <div>
          <label class="panel-label">Area / ZIP / Metro</label>
          <input class="panel-input" type="text" placeholder="e.g. 90401, 310, Los Angeles" />
        </div>
        <div>
          <label class="panel-label">Industry Focus</label>
          <input class="panel-input" type="text" placeholder="e.g. Tech, Healthcare, All" />
        </div>
      </div>
      <div class="panel-row">
        <div>
          <label class="panel-label">Property Type</label>
          <input class="panel-input" type="text" placeholder="e.g. Office, Industrial, All" />
        </div>
        <div>
          <label class="panel-label">Alert Threshold</label>
          <input class="panel-input" type="text" placeholder="e.g. Vacancy &lt;8%, Rate +25bps" />
        </div>
      </div>
      <div>
        <label class="panel-label" style="margin-bottom:8px;">Update Frequency</label>
        <div class="freq-row">
          <div class="freq-btn" onclick="selectFreq(this)">Realtime</div>
          <div class="freq-btn active" onclick="selectFreq(this)">Daily</div>
          <div class="freq-btn" onclick="selectFreq(this)">Weekly</div>
          <div class="freq-btn" onclick="selectFreq(this)">Monthly</div>
        </div>
      </div>
      <button class="panel-add-btn" onclick="addWatch()">Add to My Intelligence ‚Üí</button>
    </div>

    <!-- Active Watches -->
    <div class="panel-section">
      <div class="panel-section-title">Active Watches</div>
      <div class="watch-list" id="watch-list">
        <div class="watch-item">
          <div class="watch-item-icon">üìç</div>
          <div class="watch-item-info">
            <div class="watch-item-title">West Coast Office Markets</div>
            <div class="watch-item-meta">Vacancy rate ¬∑ All industries ¬∑ 15 submarkets</div>
            <div class="watch-item-freq">Daily ¬∑ 6:00 AM</div>
          </div>
          <div class="watch-remove">‚úï</div>
        </div>
        <div class="watch-item">
          <div class="watch-item-icon">üìà</div>
          <div class="watch-item-info">
            <div class="watch-item-title">Interest Rate ‚Üí Cap Rate Impact</div>
            <div class="watch-item-meta">Fed signals ¬∑ Office, Industrial, Retail ¬∑ All markets</div>
            <div class="watch-item-freq">Realtime alerts</div>
          </div>
          <div class="watch-remove">‚úï</div>
        </div>
        <div class="watch-item">
          <div class="watch-item-icon">üéØ</div>
          <div class="watch-item-info">
            <div class="watch-item-title">TAMI Tenant Expansion ¬∑ LA Metro</div>
            <div class="watch-item-meta">Tech, Advertising, Media, Info ¬∑ 310 / 424 area codes</div>
            <div class="watch-item-freq">Daily</div>
          </div>
          <div class="watch-remove">‚úï</div>
        </div>
        <div class="watch-item">
          <div class="watch-item-icon">üì°</div>
          <div class="watch-item-info">
            <div class="watch-item-title">Zoning Variances ¬∑ Santa Monica + Culver City</div>
            <div class="watch-item-meta">Permit filings ¬∑ All property types ¬∑ ZIP 90401, 90232</div>
            <div class="watch-item-freq">Realtime alerts</div>
          </div>
          <div class="watch-remove">‚úï</div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <div class="toast-icon">‚úÖ</div>
  <div class="toast-text"><strong>Intelligence watch added.</strong> Your agent will begin monitoring now.</div>
</div>

<style>
@keyframes pulseGold {
  0%,100% { box-shadow: 0 0 0 0 rgba(196,158,84,0.4); }
  50% { box-shadow: 0 0 0 5px rgba(196,158,84,0); }
}
</style>

<script>
// ‚îÄ‚îÄ‚îÄ ONBOARDING ‚îÄ‚îÄ‚îÄ
let currentStep = 1;
const totalSteps = 5;

const stepLabels = ['Get Started', 'Next ‚Üí', 'Next ‚Üí', 'Next ‚Üí', 'Launch Dashboard ‚Üí'];

function nextStep() {
  if (currentStep < totalSteps) {
    document.getElementById(`ob-step-${currentStep}`).classList.remove('active');
    currentStep++;
    document.getElementById(`ob-step-${currentStep}`).classList.add('active');
    document.getElementById('ob-counter').textContent = `Step ${currentStep} of ${totalSteps}`;
    document.getElementById('ob-progress').style.width = `${(currentStep / totalSteps) * 100}%`;
    document.getElementById('ob-btn-label').textContent = stepLabels[currentStep - 1];
    // update welcome name
    const nameVal = document.getElementById('ob-name').value.trim().split(' ')[0];
    document.getElementById('welcome-name').textContent = nameVal ? ', ' + nameVal : '';
  } else {
    finishOnboarding();
  }
}

function skipOnboarding() {
  finishOnboarding();
}

function finishOnboarding() {
  const overlay = document.getElementById('onboarding-overlay');
  overlay.classList.add('hidden');
  setTimeout(() => { overlay.style.display = 'none'; startTour(); }, 400);
}

function toggleChip(el) { el.classList.toggle('selected'); }

function addMarketChip() {
  const input = document.getElementById('market-zip-input');
  const val = input.value.trim();
  if (!val) return;
  // Support comma-separated entries
  val.split(',').forEach(entry => {
    const text = entry.trim();
    if (!text) return;
    const chip = document.createElement('div');
    chip.className = 'ob-chip selected';
    chip.setAttribute('onclick', 'toggleChip(this)');
    chip.textContent = text;
    document.getElementById('market-chips').appendChild(chip);
  });
  input.value = '';
  input.focus();
}

// ‚îÄ‚îÄ‚îÄ DASHBOARD TOUR ‚îÄ‚îÄ‚îÄ
const tourSteps = [
  {
    target: 'kpi-row',
    title: 'Your KPI Summary',
    desc: 'At a glance: pipeline value, active deals, vacancy trends, agent-sourced leads, and unread alerts. Updated every morning.',
    pos: 'bottom'
  },
  {
    target: 'heatmap-card',
    title: 'Submarket Heatmap',
    desc: 'Color-coded vacancy rates across every submarket you cover. Red = high vacancy, green = tight. Click any cell to drill in.',
    pos: 'bottom'
  },
  {
    target: 'agent-card',
    title: 'Live Agent Feed',
    desc: 'Real-time stream of everything your AI agents are doing right now ‚Äî alerts, leads found, documents reviewed, pitches being written.',
    pos: 'bottom'
  },
  {
    target: 'alerts-card',
    title: 'Priority Alerts',
    desc: 'Ranked by urgency. Each alert has a one-click action button so you can act immediately ‚Äî draft outreach, review a document, or deep-dive.',
    pos: 'left'
  },
  {
    target: 'add-intel-btn',
    title: '+ Add Intelligence',
    desc: 'This is how you tell LandMarq what to watch. Say it in plain English ‚Äî "track CRE growth in 310 for tech tenants" ‚Äî and an agent starts immediately.',
    pos: 'bottom'
  }
];

let tourIdx = 0;
let tourActive = false;

function startTour() {
  tourActive = true;
  tourIdx = 0;
  showTourStep();
}

function showTourStep() {
  const ring = document.getElementById('spotlight-ring');
  const tip = document.getElementById('spotlight-tooltip');
  const step = tourSteps[tourIdx];

  if (!step) { endTour(); return; }

  const target = document.getElementById(step.target);
  if (!target) { endTour(); return; }

  const rect = target.getBoundingClientRect();
  const pad = 8;

  ring.style.top = (rect.top - pad) + 'px';
  ring.style.left = (rect.left - pad) + 'px';
  ring.style.width = (rect.width + pad * 2) + 'px';
  ring.style.height = (rect.height + pad * 2) + 'px';
  ring.classList.add('visible');

  document.getElementById('tt-step').textContent = `Tour ¬∑ ${tourIdx + 1} of ${tourSteps.length}`;
  document.getElementById('tt-title').textContent = step.title;
  document.getElementById('tt-desc').textContent = step.desc;
  document.getElementById('tt-next-btn').textContent = tourIdx < tourSteps.length - 1 ? 'Next ‚Üí' : 'Done ‚úì';

  // position tooltip
  const tipW = 280, tipH = 150;
  let top, left;

  if (step.pos === 'bottom') {
    top = rect.bottom + pad + 14;
    left = rect.left;
  } else if (step.pos === 'left') {
    top = rect.top;
    left = rect.left - tipW - 20;
  } else {
    top = rect.bottom + 14;
    left = rect.left;
  }

  // clamp
  if (left + tipW > window.innerWidth - 10) left = window.innerWidth - tipW - 10;
  if (left < 10) left = 10;
  if (top + tipH > window.innerHeight - 10) top = rect.top - tipH - 14;

  tip.style.top = top + 'px';
  tip.style.left = left + 'px';
  tip.classList.add('visible');
}

function nextTourStep() {
  tourIdx++;
  if (tourIdx >= tourSteps.length) { endTour(); return; }
  showTourStep();
}

function endTour() {
  document.getElementById('spotlight-ring').classList.remove('visible');
  document.getElementById('spotlight-tooltip').classList.remove('visible');
  tourActive = false;
}

// ‚îÄ‚îÄ‚îÄ INTEL PANEL ‚îÄ‚îÄ‚îÄ
function openIntelPanel() {
  document.getElementById('intel-panel').classList.add('open');
}

function closeIntelPanel() {
  document.getElementById('intel-panel').classList.remove('open');
}

function selectCat(el) {
  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

function selectFreq(el) {
  document.querySelectorAll('.freq-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

function fillNLP(el) {
  const text = el.textContent;
  document.getElementById('nlp-input').value = text;
  document.getElementById('nlp-input').focus();
}

function submitNLP() {
  addWatch(document.getElementById('nlp-input').value);
  document.getElementById('nlp-input').value = '';
}

function addWatch(customTitle) {
  const list = document.getElementById('watch-list');
  const title = customTitle || 'New Intelligence Watch';

  const item = document.createElement('div');
  item.className = 'watch-item';
  item.style.animation = 'streamIn 0.4s ease-out';
  item.innerHTML = `
    <div class="watch-item-icon">üîç</div>
    <div class="watch-item-info">
      <div class="watch-item-title">${title.length > 60 ? title.substring(0, 60) + '...' : title}</div>
      <div class="watch-item-meta">Agent configured ¬∑ Monitoring active</div>
      <div class="watch-item-freq">Daily ¬∑ Starting now</div>
    </div>
    <div class="watch-remove" onclick="this.parentElement.remove()">‚úï</div>
  `;
  list.prepend(item);

  // Scroll to and highlight the new watch in the panel
  setTimeout(() => {
    item.scrollIntoView({ behavior: 'smooth', block: 'center' });
    item.style.boxShadow = '0 0 0 2px var(--gold), 0 0 20px rgba(196,158,84,0.3)';
    item.style.transition = 'box-shadow 0.3s ease';
    setTimeout(() => { item.style.boxShadow = 'none'; }, 3000);
  }, 100);

  // Also add a live agent feed item to show it on the dashboard
  const stream = document.getElementById('agentStream');
  if (stream) {
    const el = document.createElement('div');
    el.className = 'stream-item';
    el.style.cursor = 'pointer';
    el.innerHTML = `<div class="stream-icon icon-intel">üîç</div><div><div class="stream-text"><strong>New Watch Active:</strong> ${title.length > 50 ? title.substring(0, 50) + '...' : title}</div><div class="stream-meta"><span class="stream-tag tag-intel">Intelligence</span> just now ¬∑ Agent Configured</div></div>`;
    stream.prepend(el);
    // Highlight the new feed item
    el.style.background = 'var(--gold-dim)';
    el.style.borderLeft = '3px solid var(--gold)';
    el.style.transition = 'all 0.5s ease';
    setTimeout(() => { el.style.background = ''; el.style.borderLeft = ''; }, 4000);
    while (stream.children.length > 7) stream.removeChild(stream.lastChild);
  }

  // Close panel after short delay so user sees the feed update
  setTimeout(() => { closeIntelPanel(); }, 800);

  // Toast
  const toast = document.getElementById('toast');
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3500);

  // After panel closes, scroll to and highlight the feed item on the main dashboard
  setTimeout(() => {
    const feedItem = document.querySelector('#agentStream .stream-item');
    if (feedItem) {
      feedItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
      feedItem.style.boxShadow = '0 0 0 2px var(--gold), 0 0 20px rgba(196,158,84,0.3)';
      setTimeout(() => { feedItem.style.boxShadow = 'none'; }, 3000);
    }
  }, 1200);
}

// ‚îÄ‚îÄ‚îÄ ADD DEAL MODAL ‚îÄ‚îÄ‚îÄ
function openAddDealModal() {
  const formStyle = `style="width:100%;padding:8px 10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--cream);font-family:'Syne',sans-serif;font-size:12px;outline:none;"`;
  const labelStyle = `style="font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:0.12em;text-transform:uppercase;color:var(--text-dim);margin-bottom:4px;display:block;"`;
  const groupStyle = `style="margin-bottom:12px;"`;

  showModal('New Deal', 'Add Deal to Pipeline',
    `<div ${groupStyle}><label ${labelStyle}>Tenant Name</label><input id="deal-tenant" ${formStyle} placeholder="e.g. Acme Corp"></div>`
    + `<div ${groupStyle}><label ${labelStyle}>Deal Type</label><input id="deal-type" ${formStyle} placeholder="e.g. New Requirement, Expansion, Relocation"></div>`
    + `<div style="display:flex;gap:8px;margin-bottom:12px;">`
    + `<div style="flex:1;"><label ${labelStyle}>Market</label><input id="deal-market" ${formStyle} placeholder="e.g. Santa Monica"></div>`
    + `<div style="flex:1;"><label ${labelStyle}>Square Footage</label><input id="deal-sf" ${formStyle} placeholder="e.g. 15,000"></div></div>`
    + `<div style="display:flex;gap:8px;margin-bottom:12px;">`
    + `<div style="flex:1;"><label ${labelStyle}>Est. Value</label><input id="deal-value" ${formStyle} placeholder="e.g. $8M"></div>`
    + `<div style="flex:1;"><label ${labelStyle}>Stage</label><select id="deal-stage" ${formStyle}><option>Prospect</option><option>Qualifying</option><option>Proposal</option><option>LOI Signed</option><option>Closing</option></select></div></div>`
    + `<div style="display:flex;gap:8px;margin-bottom:12px;">`
    + `<div style="flex:1;"><label ${labelStyle}>Key Contact</label><input id="deal-contact" ${formStyle} placeholder="e.g. Jane Smith, VP"></div>`
    + `<div style="flex:1;"><label ${labelStyle}>Expected Close</label><input id="deal-close" ${formStyle} placeholder="e.g. Q3 2026"></div></div>`
    + `<div ${groupStyle}><label ${labelStyle}>Notes</label><textarea id="deal-notes" ${formStyle} rows="2" placeholder="Key details, requirements, competitive situation..."></textarea></div>`
    + `<button onclick="submitNewDeal()" style="width:100%;padding:12px;background:var(--gold);color:#0A0C0E;border:none;border-radius:4px;font-weight:700;font-family:'Syne',sans-serif;font-size:13px;cursor:pointer;">Add to Pipeline ‚Üí</button>`
  );
}

function submitNewDeal() {
  const tenant = document.getElementById('deal-tenant')?.value || 'New Deal';
  const type = document.getElementById('deal-type')?.value || 'New Requirement';
  const market = document.getElementById('deal-market')?.value || 'TBD';
  const sf = document.getElementById('deal-sf')?.value || 'TBD';
  const value = document.getElementById('deal-value')?.value || 'TBD';
  const stage = document.getElementById('deal-stage')?.value || 'Prospect';
  const contact = document.getElementById('deal-contact')?.value || 'TBD';
  const close = document.getElementById('deal-close')?.value || 'TBD';

  // Add row to pipeline table
  const tbody = document.querySelector('.pipeline-table tbody');
  if (tbody) {
    const stageClass = stage === 'Prospect' ? 'stage-prospect' : stage === 'Qualifying' ? 'stage-qualify' : stage === 'Proposal' ? 'stage-proposal' : stage === 'LOI Signed' ? 'stage-loi' : 'stage-prospect';
    const tr = document.createElement('tr');
    tr.style.animation = 'streamIn 0.4s ease-out';
    tr.style.cursor = 'pointer';
    tr.innerHTML = `<td><div class="tenant-name">${tenant}</div><div class="tenant-sub">${type}</div></td><td><span class="market-tag">${market}</span></td><td><span class="size-val">${sf}</span></td><td><span class="value-cell">${value}</span></td><td><span class="stage-pill ${stageClass}">${stage}</span></td><td><div class="prob-bar-wrap"><div class="prob-bar-bg"><div class="prob-bar-fill blue" style="width:20%"></div></div><span class="prob-val">20%</span></div></td><td style="font-family:'JetBrains Mono',monospace;font-size:8.5px;color:var(--text-mid)">${close}</td><td><div class="action-dots"><span></span><span></span><span></span></div></td>`;
    tbody.appendChild(tr);

    // Make the new row clickable
    tr.addEventListener('click', () => {
      showModal('Deal Detail', tenant,
        `<div style="font-size:13px;color:var(--text-mid);margin-bottom:16px;">${type} ¬∑ ${market}</div>`
        + detailRow('Square Footage', sf, 'var(--cream)')
        + detailRow('Estimated Value', value, 'var(--gold)')
        + detailRow('Stage', stage, 'var(--cream)')
        + detailRow('Expected Close', close, 'var(--text-mid)')
        + detailRow('Key Contact', contact, 'var(--cream)')
      );
    });
  }

  closeModal();

  // Scroll to pipeline and highlight
  setTimeout(() => {
    const pipeline = document.getElementById('pipeline-card');
    if (pipeline) {
      pipeline.scrollIntoView({ behavior: 'smooth', block: 'center' });
      pipeline.style.boxShadow = '0 0 0 2px var(--gold), 0 0 20px rgba(196,158,84,0.3)';
      pipeline.style.transition = 'box-shadow 0.5s ease';
      setTimeout(() => { pipeline.style.boxShadow = 'none'; }, 3000);
    }
  }, 200);

  // Toast
  const toast = document.getElementById('toast');
  toast.innerHTML = `<div class="toast-icon">‚úÖ</div><div class="toast-text"><strong>${tenant}</strong> added to pipeline.</div>`;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3500);
}

// watch remove
document.querySelectorAll('.watch-remove').forEach(btn => {
  btn.addEventListener('click', () => btn.parentElement.remove());
});

// Nav
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    item.classList.add('active');
  });
});

// Live agent stream
const streamContainer = document.getElementById('agentStream');
const newAlerts = [
  { icon: 'üåê', cls: 'icon-intel', text: '<strong>Market Agent</strong> updated SF Financial District vacancy to 26.3% ‚Äî highest in 18 months.', tagCls: 'tag-intel', tag: 'Market' },
  { icon: 'üéØ', cls: 'icon-lead', text: '<strong>Lead Agent</strong> identified Shopify subletting 18K SF in Santa Monica ‚Äî window opening.', tagCls: 'tag-lead', tag: 'New Lead' },
  { icon: 'üìã', cls: 'icon-doc', text: '<strong>LOI Agent</strong> completed Apex Capital clause comparison. 2 items flagged for review.', tagCls: 'tag-doc', tag: 'Document' }
];
let alertIdx = 0;
setInterval(() => {
  const a = newAlerts[alertIdx % newAlerts.length]; alertIdx++;
  const el = document.createElement('div');
  el.className = 'stream-item';
  el.innerHTML = `<div class="stream-icon ${a.cls}">${a.icon}</div><div><div class="stream-text">${a.text}</div><div class="stream-meta"><span class="stream-tag ${a.tagCls}">${a.tag}</span> just now ¬∑ Agent</div></div>`;
  streamContainer.prepend(el);
  while (streamContainer.children.length > 7) streamContainer.removeChild(streamContainer.lastChild);
}, 11000);

// ‚îÄ‚îÄ‚îÄ DETAIL MODAL SYSTEM ‚îÄ‚îÄ‚îÄ
const modalOverlay = document.createElement('div');
modalOverlay.id = 'detail-modal';
modalOverlay.style.cssText = 'position:fixed;inset:0;z-index:900;display:none;align-items:center;justify-content:center;background:rgba(10,12,14,0.85);backdrop-filter:blur(6px);';
modalOverlay.innerHTML = `
  <div id="modal-card" style="background:var(--surface);border:1px solid var(--border-gold);border-radius:12px;width:600px;max-width:90vw;max-height:85vh;overflow-y:auto;box-shadow:0 40px 100px rgba(0,0,0,0.6);animation:modalIn 0.3s ease-out;">
    <div id="modal-header" style="display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid var(--border);">
      <div>
        <div id="modal-badge" style="font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:0.15em;text-transform:uppercase;color:var(--gold);margin-bottom:4px;"></div>
        <div id="modal-title" style="font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:600;color:var(--cream);"></div>
      </div>
      <div onclick="closeModal()" style="cursor:pointer;font-size:18px;color:var(--text-dim);padding:4px 8px;">&times;</div>
    </div>
    <div id="modal-body" style="padding:24px;"></div>
  </div>
`;
document.body.appendChild(modalOverlay);
modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) closeModal(); });

function showModal(badge, title, bodyHTML) {
  document.getElementById('modal-badge').textContent = badge;
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-body').innerHTML = bodyHTML;
  modalOverlay.style.display = 'flex';
}
function closeModal() { modalOverlay.style.display = 'none'; }
document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

// Helper for detail rows
function detailRow(label, value, color) {
  return `<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);">
    <span style="font-size:12px;color:var(--text-mid);">${label}</span>
    <span style="font-size:12px;font-weight:600;color:${color || 'var(--cream)'};">${value}</span>
  </div>`;
}

// ‚îÄ‚îÄ‚îÄ KPI CARD CLICKS ‚îÄ‚îÄ‚îÄ
const kpiData = [
  { badge: 'Pipeline', title: 'Total Pipeline Value ‚Äî $218M', body: () =>
    `<div style="margin-bottom:16px;font-size:13px;color:var(--text);line-height:1.6;">Pipeline value increased 12.4% vs. last quarter, driven by Netflix HQ expansion and 3 new TAMI requirements entering qualifying stage.</div>`
    + detailRow('Netflix Inc. ‚Äî Culver City', '$42M', 'var(--gold)')
    + detailRow('Apex Capital ‚Äî Century City', '$19M', 'var(--gold)')
    + detailRow('TechCo Inc. ‚Äî Playa Vista', '$11M', 'var(--cream)')
    + detailRow('WestShore Media ‚Äî Santa Monica', '$8.5M', 'var(--cream)')
    + detailRow('Meridian Health ‚Äî Burbank', '$4.2M', 'var(--cream)')
    + detailRow('Other deals (9)', '$133.3M', 'var(--text-mid)')
    + `<div style="margin-top:16px;padding:12px;background:var(--green-dim);border:1px solid rgba(74,155,111,0.2);border-radius:6px;font-size:12px;color:var(--green);">‚ñ≤ Weighted pipeline up $24M from Q4 2025. 4 deals expected to close by May.</div>`
  },
  { badge: 'Deals', title: 'Active Deals ‚Äî 14', body: () =>
    `<div style="margin-bottom:16px;font-size:13px;color:var(--text);line-height:1.6;">3 new deals entered pipeline this month. 2 deals advanced stages (Qualifying ‚Üí Proposal).</div>`
    + detailRow('Prospect', '3 deals', 'var(--text-mid)')
    + detailRow('Qualifying', '4 deals', 'var(--blue)')
    + detailRow('Proposal', '4 deals', 'var(--amber)')
    + detailRow('LOI Signed', '2 deals', 'var(--gold)')
    + detailRow('Closing', '1 deal', 'var(--green)')
    + `<div style="margin-top:16px;padding:12px;background:var(--gold-dim);border:1px solid var(--border-gold);border-radius:6px;font-size:12px;color:var(--gold);">Next milestone: Apex Capital closing expected Mar '26. Netflix proposal due Apr 1.</div>`
  },
  { badge: 'Vacancy', title: 'Avg. LA Office Vacancy ‚Äî 14.2%', body: () =>
    `<div style="margin-bottom:16px;font-size:13px;color:var(--text);line-height:1.6;">LA metro vacancy trending down 0.8% over 90 days. TAMI sector absorption driving tightening in Westside submarkets.</div>`
    + detailRow('Santa Monica', '9.8%', 'var(--green)')
    + detailRow('Playa Vista', '8.1%', 'var(--green)')
    + detailRow('Culver City', '11.2%', 'var(--cream)')
    + detailRow('Century City', '12.6%', 'var(--amber)')
    + detailRow('DTLA', '18.4%', 'var(--red)')
    + detailRow('Wilshire Corridor', '16.1%', 'var(--red)')
    + `<div style="margin-top:16px;padding:12px;background:var(--blue-dim);border:1px solid rgba(74,127,165,0.2);border-radius:6px;font-size:12px;color:var(--blue);">‚ñº Westside vacancy at lowest since 2022. Expect upward rent pressure in Q2.</div>`
  },
  { badge: 'Leads', title: 'Agent-Sourced Leads ‚Äî 31 (30d)', body: () =>
    `<div style="margin-bottom:16px;font-size:13px;color:var(--text);line-height:1.6;">8 new leads this month, up from 23 last month. Lead Agent accuracy: 78% qualification rate.</div>`
    + detailRow('TAMI Sector', '14 leads', 'var(--gold)')
    + detailRow('Healthcare', '6 leads', 'var(--green)')
    + detailRow('Financial Services', '5 leads', 'var(--blue)')
    + detailRow('Professional Services', '4 leads', 'var(--cream)')
    + detailRow('Other', '2 leads', 'var(--text-mid)')
    + `<div style="margin-top:16px;padding:12px;background:var(--green-dim);border:1px solid rgba(74,155,111,0.2);border-radius:6px;font-size:12px;color:var(--green);">Top signal: TechCo Inc. ‚Äî 40+ LA job postings, WeWork badge-in up 62%. High intent.</div>`
  },
  { badge: 'Market', title: 'Avg. NNN PSF ‚Äî $62 (SF Metro)', body: () =>
    `<div style="margin-bottom:16px;font-size:13px;color:var(--text);line-height:1.6;">NNN asking rents up $1.20/SF MoM across LA metro. Class A driving the increase.</div>`
    + detailRow('Class A ‚Äî Westside', '$78/SF', 'var(--gold)')
    + detailRow('Class A ‚Äî DTLA', '$54/SF', 'var(--cream)')
    + detailRow('Class B ‚Äî Westside', '$52/SF', 'var(--cream)')
    + detailRow('Class B ‚Äî Valley', '$38/SF', 'var(--text-mid)')
    + `<div style="margin-top:16px;padding:12px;background:var(--gold-dim);border:1px solid var(--border-gold);border-radius:6px;font-size:12px;color:var(--gold);">Trend: Westside Class A rents up 6.2% YoY. Expect acceleration with declining vacancy.</div>`
  },
  { badge: 'Alerts', title: 'Unread Alerts ‚Äî 7', body: () =>
    `<div style="margin-bottom:16px;font-size:13px;color:var(--text);line-height:1.6;">3 high priority alerts require immediate attention. 2 medium alerts pending review.</div>`
    + `<div style="padding:10px 12px;background:var(--red-dim);border:1px solid rgba(192,83,58,0.2);border-left:3px solid var(--red);border-radius:4px;margin-bottom:6px;"><div style="font-size:12px;font-weight:600;color:var(--cream);">‚ö° Snap vacating 42K SF ‚Äî Santa Monica</div><div style="font-size:11px;color:var(--text-mid);margin-top:2px;">First-mover window: ~6 weeks</div></div>`
    + `<div style="padding:10px 12px;background:var(--red-dim);border:1px solid rgba(192,83,58,0.2);border-left:3px solid var(--red);border-radius:4px;margin-bottom:6px;"><div style="font-size:12px;font-weight:600;color:var(--cream);">üìã LOI Clause Mismatch ‚Äî Apex Capital</div><div style="font-size:11px;color:var(--text-mid);margin-top:2px;">Non-standard co-tenancy clause flagged</div></div>`
    + `<div style="padding:10px 12px;background:var(--gold-dim);border:1px solid var(--border-gold);border-left:3px solid var(--gold);border-radius:4px;margin-bottom:6px;"><div style="font-size:12px;font-weight:600;color:var(--cream);">üéØ TechCo Expansion Signal</div><div style="font-size:11px;color:var(--text-mid);margin-top:2px;">40+ LA job postings detected</div></div>`
  }
];

document.querySelectorAll('.kpi-card').forEach((card, i) => {
  card.style.cursor = 'pointer';
  card.addEventListener('click', () => {
    const d = kpiData[i];
    if (d) showModal(d.badge, d.title, d.body());
  });
});

// ‚îÄ‚îÄ‚îÄ HEATMAP CELL CLICKS ‚îÄ‚îÄ‚îÄ
const heatmapDetail = {
  'DTLA': { vacancy: '18.4%', trend: '‚ñ≤ 1.2%', available: '2.4M SF', avgRent: '$54/SF', topTenants: 'Wells Fargo, Deloitte, CBRE', outlook: 'High vacancy persists. Sublease space still entering market. Watch for conversions.' },
  'Culver City': { vacancy: '11.2%', trend: '‚ñº 0.6%', available: '890K SF', avgRent: '$62/SF', topTenants: 'Amazon Studios, Apple TV+, Sony', outlook: 'Tightening. Media & entertainment driving absorption. Limited new supply.' },
  'Santa Monica': { vacancy: '9.8%', trend: '‚ñº 1.1%', available: '620K SF', avgRent: '$72/SF', topTenants: 'Snap Inc., Hulu, Kite Pharma', outlook: 'Snap departure creates opportunity. 3 TAMI tenants actively searching this submarket.' },
  'Playa Vista': { vacancy: '8.1%', trend: '‚ñº 0.9%', available: '410K SF', avgRent: '$68/SF', topTenants: 'Google, Facebook, IMAX', outlook: 'Tightest Westside submarket. Badge-in data shows 74% occupancy vs 61% DTLA avg.' },
  'El Segundo': { vacancy: '6.7%', trend: '‚ñº 0.4%', available: '340K SF', avgRent: '$48/SF', topTenants: 'Northrop Grumman, Raytheon, Beyond Meat', outlook: 'Aerospace/defense anchor tenants. Very tight. New development planned 2027.' },
  'Century City': { vacancy: '12.6%', trend: '‚ñº 0.3%', available: '780K SF', avgRent: '$82/SF', topTenants: 'CAA, Greenberg Traurig, Ares Management', outlook: 'Premium rents. Financial/legal sector dominant. Apex Capital deal could tighten further.' },
  'West Hollywood': { vacancy: '7.3%', trend: '‚ñº 0.5%', available: '280K SF', avgRent: '$58/SF', topTenants: 'WME, Spotify, Various boutique', outlook: 'Creative office strong. Limited inventory. Rents rising.' },
  'Wilshire Corridor': { vacancy: '16.1%', trend: '‚ñ≤ 0.4%', available: '1.8M SF', avgRent: '$46/SF', topTenants: 'Various mid-size firms', outlook: 'Older inventory struggling. Flight to quality ongoing. Watch for repositioning opportunities.' },
  'Burbank': { vacancy: '10.4%', trend: '‚ñº 0.7%', available: '520K SF', avgRent: '$52/SF', topTenants: 'Warner Bros, Disney, Netflix (post)', outlook: 'Entertainment hub stable. Healthcare sector growing. Meridian Health actively looking.' },
  'Manhattan Bch': { vacancy: '5.9%', trend: '‚ñº 0.2%', available: '180K SF', avgRent: '$56/SF', topTenants: 'Skechers, Manhattan Beach Studios', outlook: 'Extremely tight. Almost no available Class A. Premium location driving wait lists.' },
  'SF Financial': { vacancy: '26.3%', trend: '‚ñ≤ 2.1%', available: '12.4M SF', avgRent: '$68/SF', topTenants: 'Salesforce, Wells Fargo, JPMorgan', outlook: 'Highest vacancy in 18 months. Sublease glut. Major correction potential.' },
  'SF SOMA': { vacancy: '22.1%', trend: '‚ñ≤ 1.4%', available: '6.8M SF', avgRent: '$62/SF', topTenants: 'Airbnb, Pinterest, Stripe', outlook: 'Tech downsizing continues. Some AI startups backfilling but not enough to offset.' },
  'SF Mission': { vacancy: '14.8%', trend: '‚ñº 0.3%', available: '2.1M SF', avgRent: '$54/SF', topTenants: 'Various tech startups', outlook: 'Stabilizing. Smaller suites in demand. Creative/flex space doing better than traditional.' },
  'Bellevue WA': { vacancy: '9.2%', trend: '‚ñº 1.0%', available: '1.2M SF', avgRent: '$58/SF', topTenants: 'Meta, T-Mobile, Paccar', outlook: 'Strong recovery. Tech expansion resuming. Spring Lane development 80% pre-leased.' },
  'Seattle SLU': { vacancy: '11.0%', trend: '‚ñº 0.6%', available: '2.8M SF', avgRent: '$52/SF', topTenants: 'Amazon, Google, Facebook', outlook: 'Amazon RTO driving absorption. New supply delivering but demand keeping pace.' }
};

document.querySelectorAll('.heatmap-cell').forEach(cell => {
  cell.style.cursor = 'pointer';
  cell.addEventListener('click', () => {
    const market = cell.querySelector('.heat-market').textContent;
    const d = heatmapDetail[market];
    if (!d) return;
    showModal('Submarket Detail', market,
      detailRow('Vacancy Rate', d.vacancy, parseFloat(d.vacancy) > 15 ? 'var(--red)' : parseFloat(d.vacancy) > 10 ? 'var(--amber)' : 'var(--green)')
      + detailRow('90-Day Trend', d.trend, d.trend.includes('‚ñ≤') ? 'var(--red)' : 'var(--green)')
      + detailRow('Available SF', d.available, 'var(--cream)')
      + detailRow('Avg. Asking Rent', d.avgRent, 'var(--gold)')
      + detailRow('Key Tenants', d.topTenants, 'var(--cream)')
      + `<div style="margin-top:16px;padding:12px;background:var(--surface-2);border:1px solid var(--border);border-radius:6px;font-size:12px;color:var(--text);line-height:1.5;"><strong style="color:var(--cream);">Outlook:</strong> ${d.outlook}</div>`
    );
  });
});

// ‚îÄ‚îÄ‚îÄ ALERT ACTION BUTTON CLICKS ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.alert-action-btn').forEach(btn => {
  btn.style.cursor = 'pointer';
  btn.addEventListener('click', (e) => {
    e.stopPropagation();
    const text = btn.textContent.trim();
    if (text.includes('Draft Outreach')) {
      showModal('Outreach Agent', 'Draft Outreach ‚Äî Snap Inc. Space',
        `<div style="font-size:13px;color:var(--text);line-height:1.6;margin-bottom:16px;">Your Outreach Agent is drafting a personalized pitch targeting TAMI tenants for the 42K SF vacancy at 2101 Colorado Ave, Santa Monica.</div>`
        + `<div style="background:var(--surface-2);border:1px solid var(--border);border-radius:8px;padding:16px;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text);line-height:1.7;">`
        + `<div style="color:var(--gold);margin-bottom:8px;">DRAFT ¬∑ Generating...</div>`
        + `Subject: Premium 42K SF ‚Äî 2101 Colorado Ave, Santa Monica<br><br>`
        + `Hi [Contact],<br><br>`
        + `A unique opportunity just opened at 2101 Colorado Ave in Santa Monica ‚Äî 42,000 SF of Class A creative office with ocean proximity, previously occupied by Snap Inc.<br><br>`
        + `Given [Company]'s growth trajectory and West LA focus, this could be an ideal fit. The space features open floor plans, private outdoor terraces, and fiber connectivity.<br><br>`
        + `Would you have 15 minutes this week to discuss?<br><br>`
        + `Best,<br>[Your Name]`
        + `</div>`
        + `<div style="display:flex;gap:8px;margin-top:16px;"><button style="flex:1;padding:10px;background:var(--gold);color:#0A0C0E;border:none;border-radius:4px;font-weight:700;font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Send to 3 Leads ‚Üí</button><button style="flex:1;padding:10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Edit Draft</button></div>`
      );
    } else if (text.includes('Review Comparison')) {
      showModal('LOI Agent', 'Clause Comparison ‚Äî Apex Capital',
        `<div style="font-size:13px;color:var(--text);line-height:1.6;margin-bottom:16px;">LOI Agent flagged 2 non-standard clauses in the Apex Capital draft vs. your gold standard template.</div>`
        + `<div style="background:var(--red-dim);border:1px solid rgba(192,83,58,0.2);border-radius:8px;padding:14px;margin-bottom:10px;">`
        + `<div style="font-size:12px;font-weight:600;color:var(--cream);margin-bottom:6px;">‚ö† Section 4.2 ‚Äî Co-Tenancy Clause</div>`
        + `<div style="font-size:11px;color:var(--text);line-height:1.5;"><strong style="color:var(--red);">Their version:</strong> Tenant may terminate if anchor tenant vacates >50% of premises.<br><strong style="color:var(--green);">Your standard:</strong> No co-tenancy termination rights. Rent abatement only if >60% vacant for 12+ months.</div></div>`
        + `<div style="background:var(--gold-dim);border:1px solid var(--border-gold);border-radius:8px;padding:14px;margin-bottom:10px;">`
        + `<div style="font-size:12px;font-weight:600;color:var(--cream);margin-bottom:6px;">‚ö† Section 7 ‚Äî Assignment Rights</div>`
        + `<div style="font-size:11px;color:var(--text);line-height:1.5;"><strong style="color:var(--amber);">Their version:</strong> Unrestricted assignment to affiliates without landlord consent.<br><strong style="color:var(--green);">Your standard:</strong> Landlord consent required for all assignments; affiliates require 30-day notice.</div></div>`
        + `<div style="display:flex;gap:8px;margin-top:16px;"><button style="flex:1;padding:10px;background:var(--gold);color:#0A0C0E;border:none;border-radius:4px;font-weight:700;font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Generate Redline ‚Üí</button><button style="flex:1;padding:10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">View Full LOI</button></div>`
      );
    } else if (text.includes('Lead Profile')) {
      showModal('Lead Agent', 'Lead Profile ‚Äî TechCo Inc.',
        `<div style="display:flex;gap:16px;margin-bottom:16px;"><div style="width:48px;height:48px;border-radius:8px;background:var(--gold-dim);border:1px solid var(--border-gold);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;">üéØ</div><div><div style="font-size:16px;font-weight:600;color:var(--cream);">TechCo Inc.</div><div style="font-size:12px;color:var(--text-mid);">Series C ¬∑ SaaS ¬∑ 200-500 employees</div></div></div>`
        + detailRow('Signal Strength', '‚óè Very High', 'var(--green)')
        + detailRow('LA Job Postings (30d)', '40+', 'var(--gold)')
        + detailRow('WeWork Badge-In Œî', '+62% MoM', 'var(--green)')
        + detailRow('Est. Space Need', '15,000 ‚Äì 25,000 SF', 'var(--cream)')
        + detailRow('Preferred Submarkets', 'Playa Vista, Culver City', 'var(--cream)')
        + detailRow('Timeline', 'Q3 2026 (estimated)', 'var(--text-mid)')
        + `<div style="margin-top:16px;padding:12px;background:var(--surface-2);border:1px solid var(--border);border-radius:6px;font-size:12px;color:var(--text);line-height:1.5;"><strong style="color:var(--cream);">Agent Notes:</strong> High-growth SaaS company currently in flex space at WeWork Playa Vista. Rapid headcount growth suggests they'll outgrow current location within 6 months. Key decision-maker: VP of Operations.</div>`
        + `<div style="display:flex;gap:8px;margin-top:16px;"><button style="flex:1;padding:10px;background:var(--gold);color:#0A0C0E;border:none;border-radius:4px;font-weight:700;font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Draft Outreach ‚Üí</button><button style="flex:1;padding:10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Add to Pipeline</button></div>`
      );
    } else if (text.includes('Impact Report')) {
      showModal('Macro Agent', 'Interest Rate Impact Analysis',
        `<div style="font-size:13px;color:var(--text);line-height:1.6;margin-bottom:16px;">Fed signaled a pause. Model projects cap rate compression across West Coast CRE over the next 90 days.</div>`
        + detailRow('Fed Funds Rate', '4.25% (hold)', 'var(--cream)')
        + detailRow('10Y Treasury', '3.82% (‚ñº 12bps)', 'var(--green)')
        + detailRow('Office Cap Rate Œî', '-15bps projected', 'var(--green)')
        + detailRow('Industrial Cap Rate Œî', '-25bps projected', 'var(--green)')
        + detailRow('Retail Cap Rate Œî', '-8bps projected', 'var(--text-mid)')
        + `<div style="margin-top:16px;padding:12px;background:var(--green-dim);border:1px solid rgba(74,155,111,0.2);border-radius:6px;font-size:12px;color:var(--green);line-height:1.5;">Implication: Asset values could increase 2-4% in industrial over 90 days. Consider accelerating Burbank deal timeline.</div>`
      );
    }
  });
});

// ‚îÄ‚îÄ‚îÄ ALERT ITEM CLICKS (with next-step workflows) ‚îÄ‚îÄ‚îÄ
const alertWorkflows = [
  { // Snap vacating - High
    title: 'Snap Vacating 42K SF ‚Äî Santa Monica', steps: [
      { label: 'Review Intel Report', status: 'done', desc: 'Agent identified vacancy + 3 matching tenants' },
      { label: 'Draft Outreach to Matching Tenants', status: 'ready', desc: 'Send personalized pitches to TechCo, WestShore, Shopify' },
      { label: 'Schedule Property Tour', status: 'upcoming', desc: 'Coordinate walkthroughs with interested tenants' },
      { label: 'Submit Proposals', status: 'upcoming', desc: 'Prepare competitive proposals for shortlisted tenants' }
    ]
  },
  { // LOI Mismatch - High
    title: 'LOI Clause Mismatch ‚Äî Apex Capital', steps: [
      { label: 'LOI Agent Reviewed Document', status: 'done', desc: 'Flagged 2 non-standard clauses (Sec 4.2 & 7)' },
      { label: 'Review Clause Comparison', status: 'ready', desc: 'Compare their terms against your gold standard' },
      { label: 'Generate Redline', status: 'upcoming', desc: 'Auto-generate redline with your preferred language' },
      { label: 'Send Counter to Apex Capital', status: 'upcoming', desc: 'Deliver revised LOI to David Park, COO' }
    ]
  },
  { // TechCo - Medium
    title: 'TechCo Inc. Expansion Signal', steps: [
      { label: 'Lead Agent Identified Signal', status: 'done', desc: '40+ job postings, WeWork badge-in +62%' },
      { label: 'Review Lead Profile', status: 'ready', desc: 'Confirm company details and space requirements' },
      { label: 'Draft Personalized Outreach', status: 'upcoming', desc: 'Reach VP of Operations with tailored pitch' },
      { label: 'Add to Pipeline', status: 'upcoming', desc: 'Create deal record and assign to tracking' }
    ]
  },
  { // Interest Rate - Medium
    title: 'Interest Rate Watch Triggered', steps: [
      { label: 'Macro Agent Detected Fed Signal', status: 'done', desc: 'Fed pause ‚Üí cap rate compression projected' },
      { label: 'Review Impact Analysis', status: 'ready', desc: 'See projected cap rate changes by sector' },
      { label: 'Adjust Deal Timelines', status: 'upcoming', desc: 'Consider accelerating Burbank deal' },
      { label: 'Update Client Advisory', status: 'upcoming', desc: 'Brief clients on rate environment shift' }
    ]
  },
  { // Playa Vista - Low
    title: 'Playa Vista Occupancy Up', steps: [
      { label: 'Intel Agent Reported', status: 'done', desc: 'Badge-in 74% vs 61% DTLA ‚Äî preference shift' },
      { label: 'Review Submarket Data', status: 'ready', desc: 'Deep-dive into Playa Vista metrics' }
    ]
  },
  { // CBRE closed - Low
    title: 'CBRE Deal Closed ‚Äî Water Garden', steps: [
      { label: 'Intel Agent Reported', status: 'done', desc: '18,500 SF closed. 3 remaining comparables in SM.' },
      { label: 'Update Comp Set', status: 'ready', desc: 'Refresh comparable listings for Santa Monica' }
    ]
  }
];

document.querySelectorAll('.alert-item').forEach((item, i) => {
  item.style.cursor = 'pointer';
  item.addEventListener('click', () => {
    const wf = alertWorkflows[i];
    const title = item.querySelector('.alert-title')?.textContent || 'Alert';
    const body = item.querySelector('.alert-body')?.textContent || '';
    const agent = item.querySelector('.alert-agent')?.textContent || '';
    const time = item.querySelector('.alert-time')?.textContent || '';
    let stepsHtml = '';
    if (wf) {
      stepsHtml = `<div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:0.1em;margin:16px 0 10px;">NEXT STEPS</div>`;
      wf.steps.forEach((s, si) => {
        const colors = { done: { bg: 'var(--green-dim)', border: 'rgba(74,155,111,0.2)', icon: '‚úì', iconColor: 'var(--green)' }, ready: { bg: 'var(--gold-dim)', border: 'var(--border-gold)', icon: '‚Üí', iconColor: 'var(--gold)' }, upcoming: { bg: 'var(--surface-2)', border: 'var(--border)', icon: (si+1).toString(), iconColor: 'var(--text-dim)' } };
        const c = colors[s.status];
        stepsHtml += `<div style="display:flex;gap:10px;align-items:flex-start;padding:10px 12px;background:${c.bg};border:1px solid ${c.border};border-radius:6px;margin-bottom:6px;${s.status === 'ready' ? 'cursor:pointer;' : ''}"><div style="width:22px;height:22px;border-radius:50%;background:${s.status === 'done' ? 'var(--green)' : s.status === 'ready' ? 'var(--gold)' : 'var(--surface-3)'};display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:${s.status === 'upcoming' ? 'var(--text-dim)' : '#0A0C0E'};flex-shrink:0;">${c.icon}</div><div><div style="font-size:12px;font-weight:600;color:var(--cream);${s.status === 'done' ? 'text-decoration:line-through;opacity:0.6;' : ''}">${s.label}</div><div style="font-size:11px;color:var(--text-mid);margin-top:2px;">${s.desc}</div></div></div>`;
      });
    }
    showModal('Alert Detail', title,
      `<div style="font-size:13px;color:var(--text);line-height:1.6;margin-bottom:12px;">${body}</div>`
      + detailRow('Source Agent', agent, 'var(--gold)')
      + detailRow('Time', time, 'var(--text-mid)')
      + stepsHtml
    );
  });
});

// ‚îÄ‚îÄ‚îÄ PIPELINE ROW CLICKS ‚îÄ‚îÄ‚îÄ
const dealDetails = [
  { name: 'Netflix Inc.', sub: 'HQ Expansion', market: 'Culver City', sf: '~60,000 SF', value: '$42M', stage: 'Proposal', prob: '72%', close: 'Apr 2026', contact: 'Sarah Chen, VP Real Estate', notes: 'Seeking creative office with production-adjacent space. Touring 3 buildings. Prefer ground-floor with outdoor areas. Budget: $65-72/SF NNN.' },
  { name: 'Apex Capital Group', sub: 'Relocation', market: 'Century City', sf: '28,500 SF', value: '$19M', stage: 'LOI Signed', prob: '88%', close: 'Mar 2026', contact: 'David Park, COO', notes: 'LOI signed with 2 flagged clauses pending resolution. High-floor preference. Willing to pay premium for views. Current lease expires June 2026.' },
  { name: 'TechCo Inc.', sub: 'New Requirement', market: 'Playa Vista', sf: '~20,000 SF', value: '$11M', stage: 'Qualifying', prob: '38%', close: 'Q3 2026', contact: 'VP Operations (TBD)', notes: 'Agent-sourced lead. Currently at WeWork. 40+ job postings suggest rapid growth. Need to confirm budget and timeline. Badge-in data shows high engagement.' },
  { name: 'WestShore Media', sub: 'Expansion', market: 'Santa Monica', sf: '14,200 SF', value: '$8.5M', stage: 'Proposal', prob: '61%', close: 'May 2026', contact: 'Lisa Tran, Head of Operations', notes: 'Expanding content production team. Need flexible layout with edit bays. Competing with Culver City options. Price-sensitive.' },
  { name: 'Meridian Health Partners', sub: 'New Requirement', market: 'Burbank', sf: '9,000 SF', value: '$4.2M', stage: 'Prospect', prob: '24%', close: 'Q4 2026', contact: 'Michael Torres, CFO', notes: 'Healthcare clinic + admin combo space. Specific zoning requirements. Early stage ‚Äî still evaluating Burbank vs Glendale.' }
];

document.querySelectorAll('.pipeline-table tbody tr').forEach((row, i) => {
  row.style.cursor = 'pointer';
  row.addEventListener('click', () => {
    const d = dealDetails[i];
    if (!d) return;
    showModal('Deal Detail', d.name,
      `<div style="font-size:13px;color:var(--text-mid);margin-bottom:16px;">${d.sub} ¬∑ ${d.market}</div>`
      + detailRow('Square Footage', d.sf, 'var(--cream)')
      + detailRow('Estimated Value', d.value, 'var(--gold)')
      + detailRow('Stage', d.stage, 'var(--cream)')
      + detailRow('Win Probability', d.prob, parseInt(d.prob) > 70 ? 'var(--green)' : parseInt(d.prob) > 50 ? 'var(--amber)' : 'var(--red)')
      + detailRow('Expected Close', d.close, 'var(--text-mid)')
      + detailRow('Key Contact', d.contact, 'var(--cream)')
      + `<div style="margin-top:16px;padding:12px;background:var(--surface-2);border:1px solid var(--border);border-radius:6px;font-size:12px;color:var(--text);line-height:1.5;"><strong style="color:var(--cream);">Notes:</strong> ${d.notes}</div>`
      + `<div style="display:flex;gap:8px;margin-top:16px;"><button style="flex:1;padding:10px;background:var(--gold);color:#0A0C0E;border:none;border-radius:4px;font-weight:700;font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Draft Follow-Up ‚Üí</button><button style="flex:1;padding:10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Update Stage</button></div>`
    );
  });
});

// ‚îÄ‚îÄ‚îÄ AGENT FEED ITEM CLICKS (rich contextual views) ‚îÄ‚îÄ‚îÄ
const agentFeedDetails = [
  { // Snap vacating
    badge: 'Intel Agent', title: 'Snap Inc. Vacating 42K SF ‚Äî Santa Monica',
    body: () => `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">Snap Inc. is vacating 42,000 SF of Class A creative office at 2101 Colorado Ave, Santa Monica. Lease expires Q2 2026. Intel Agent has identified 3 TAMI tenants actively searching in this submarket.</div>`
      + `<div style="background:var(--surface-2);border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:12px;">`
      + `<div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:0.1em;margin-bottom:10px;">INTEL REPORT</div>`
      + detailRow('Property', '2101 Colorado Ave, Santa Monica', 'var(--cream)')
      + detailRow('Size', '42,000 SF ¬∑ Class A Creative', 'var(--cream)')
      + detailRow('Current Tenant', 'Snap Inc.', 'var(--cream)')
      + detailRow('Lease Expiry', 'Q2 2026', 'var(--amber)')
      + detailRow('Asking Rent', '$72/SF NNN (est.)', 'var(--gold)')
      + detailRow('First-Mover Window', '~6 weeks', 'var(--red)')
      + `</div>`
      + `<div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-dim);letter-spacing:0.1em;margin-bottom:8px;">MATCHING TENANTS IN SUBMARKET</div>`
      + `<div style="display:flex;flex-direction:column;gap:6px;margin-bottom:16px;">`
      + `<div style="padding:8px 10px;background:var(--green-dim);border:1px solid rgba(74,155,111,0.2);border-radius:4px;font-size:11px;color:var(--cream);">TechCo Inc. ‚Äî 20K SF need, Playa Vista/SM preferred</div>`
      + `<div style="padding:8px 10px;background:var(--green-dim);border:1px solid rgba(74,155,111,0.2);border-radius:4px;font-size:11px;color:var(--cream);">WestShore Media ‚Äî 14.2K SF expansion, SM top choice</div>`
      + `<div style="padding:8px 10px;background:var(--gold-dim);border:1px solid var(--border-gold);border-radius:4px;font-size:11px;color:var(--cream);">Shopify (sublease exit) ‚Äî 18K SF, exploring SM</div>`
      + `</div>`
      + `<div style="display:flex;gap:8px;"><button onclick="closeModal()" style="flex:1;padding:10px;background:var(--gold);color:#0A0C0E;border:none;border-radius:4px;font-weight:700;font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Draft Outreach to All 3 ‚Üí</button><button onclick="closeModal()" style="flex:1;padding:10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">View Property Details</button></div>`
  },
  { // TechCo lead
    badge: 'Lead Agent', title: 'New Lead ‚Äî TechCo Inc. Expansion Signal',
    body: () => `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">Lead Agent detected high-intent expansion signals from TechCo Inc., a Series C SaaS company currently in flex space at WeWork Playa Vista.</div>`
      + `<div style="background:var(--surface-2);border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:12px;">`
      + `<div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:0.1em;margin-bottom:10px;">LEAD PROFILE</div>`
      + detailRow('Company', 'TechCo Inc. ¬∑ Series C ¬∑ SaaS', 'var(--cream)')
      + detailRow('Employees', '200‚Äì500 (growing)', 'var(--cream)')
      + detailRow('Signal: Job Postings', '40+ LA roles in 30 days', 'var(--green)')
      + detailRow('Signal: Badge-In', '+62% MoM at current WeWork', 'var(--green)')
      + detailRow('Est. Space Need', '15,000‚Äì25,000 SF', 'var(--cream)')
      + detailRow('Preferred Markets', 'Playa Vista, Culver City', 'var(--cream)')
      + detailRow('Timeline', 'Q3 2026 (estimated)', 'var(--text-mid)')
      + `</div>`
      + `<div style="display:flex;gap:8px;"><button onclick="closeModal()" style="flex:1;padding:10px;background:var(--gold);color:#0A0C0E;border:none;border-radius:4px;font-weight:700;font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Draft Outreach ‚Üí</button><button onclick="closeModal()" style="flex:1;padding:10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Add to Pipeline ‚Üí</button></div>`
  },
  { // LOI clause
    badge: 'LOI Agent', title: 'Document Review ‚Äî Apex Capital LOI',
    body: () => `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">LOI Agent has completed automated review of the Apex Capital draft LOI and flagged 2 non-standard clauses against your gold template.</div>`
      + `<div style="background:var(--surface-2);border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:12px;">`
      + `<div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:0.1em;margin-bottom:10px;">DOCUMENT: APEX_CAPITAL_LOI_V3.PDF</div>`
      + `<div style="padding:10px;background:var(--bg);border:1px solid var(--border);border-radius:4px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-dim);line-height:1.6;margin-bottom:12px;max-height:100px;overflow-y:auto;">`
      + `<span style="color:var(--red);text-decoration:line-through;">Section 4.2: Tenant may terminate if anchor tenant vacates >50% of premises.</span><br>`
      + `<span style="color:var(--green);">Section 4.2: No co-tenancy termination rights. Rent abatement only if >60% vacant for 12+ months.</span>`
      + `</div>`
      + detailRow('Clauses Reviewed', '24', 'var(--cream)')
      + detailRow('Flagged Issues', '2 non-standard', 'var(--red)')
      + detailRow('Risk Level', 'Medium ‚Äî co-tenancy + assignment', 'var(--amber)')
      + `</div>`
      + `<div style="display:flex;gap:8px;"><button onclick="closeModal()" style="flex:1;padding:10px;background:var(--gold);color:#0A0C0E;border:none;border-radius:4px;font-weight:700;font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Generate Redline ‚Üí</button><button onclick="closeModal()" style="flex:1;padding:10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">View Full Document</button></div>`
  },
  { // Zoning variance
    badge: 'Permit Agent', title: 'Zoning Alert ‚Äî 1150 S Olive St',
    body: () => `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">Permit Agent detected a new zoning variance filing for 1150 S Olive St, DTLA ‚Äî mixed-use conversion from office to residential/commercial.</div>`
      + `<div style="background:var(--surface-2);border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:12px;">`
      + `<div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:0.1em;margin-bottom:10px;">PERMIT FILING</div>`
      + detailRow('Address', '1150 S Olive St, Los Angeles 90015', 'var(--cream)')
      + detailRow('Filing Type', 'Zoning Variance ‚Äî Mixed-Use Conversion', 'var(--cream)')
      + detailRow('Current Use', 'Class B Office ¬∑ 180,000 SF', 'var(--cream)')
      + detailRow('Proposed', 'Residential/Commercial Mixed-Use', 'var(--amber)')
      + detailRow('Filed', 'Feb 23, 2026', 'var(--text-mid)')
      + detailRow('Impact', 'Removes 180K SF office inventory from DTLA', 'var(--red)')
      + `</div>`
      + `<div style="padding:10px;background:var(--gold-dim);border:1px solid var(--border-gold);border-radius:6px;font-size:12px;color:var(--gold);margin-bottom:12px;">This conversion will tighten DTLA office supply. Monitor for rent impact on remaining Class A inventory.</div>`
      + `<div style="display:flex;gap:8px;"><button onclick="closeModal()" style="flex:1;padding:10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">View Full Filing</button><button onclick="closeModal()" style="flex:1;padding:10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Track This Property</button></div>`
  },
  { // Outreach in progress
    badge: 'Outreach Agent', title: 'Drafting Pitch ‚Äî Netflix HQ Expansion',
    body: () => `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">Outreach Agent is generating a personalized pitch for Sarah Chen, VP Real Estate at Netflix, regarding the Culver City HQ expansion (~60K SF).</div>`
      + `<div style="background:var(--surface-2);border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:12px;">`
      + `<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;"><div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:0.1em;">DRAFT IN PROGRESS</div><div style="font-size:10px;color:var(--green);">‚óè Generating...</div></div>`
      + `<div style="padding:12px;background:var(--bg);border:1px solid var(--border);border-radius:4px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text);line-height:1.7;">`
      + `<strong style="color:var(--cream);">To:</strong> Sarah Chen, VP Real Estate<br>`
      + `<strong style="color:var(--cream);">Re:</strong> Culver City Creative Office ‚Äî 60K SF<br><br>`
      + `Hi Sarah,<br><br>`
      + `Following up on Netflix's Culver City expansion plans ‚Äî we've identified 3 properties within your criteria that offer the production-adjacent creative space your team needs...<br><br>`
      + `<span style="color:var(--text-dim);">[Agent completing personalization based on deal history and tenant preferences...]</span>`
      + `</div></div>`
      + `<div style="display:flex;gap:8px;"><button onclick="closeModal()" style="flex:1;padding:10px;background:var(--gold);color:#0A0C0E;border:none;border-radius:4px;font-weight:700;font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Review When Ready</button><button onclick="closeModal()" style="flex:1;padding:10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Edit Parameters</button></div>`
  }
];

document.querySelectorAll('.stream-item').forEach((item, i) => {
  item.style.cursor = 'pointer';
  item.addEventListener('click', () => {
    const d = agentFeedDetails[i];
    if (d) {
      showModal(d.badge, d.title, d.body());
    } else {
      const text = item.querySelector('.stream-text')?.innerHTML || '';
      const meta = item.querySelector('.stream-meta')?.textContent || '';
      showModal('Agent Activity', 'Activity Detail',
        `<div style="font-size:14px;color:var(--text);line-height:1.7;margin-bottom:16px;">${text}</div>`
        + `<div style="font-size:11px;color:var(--text-dim);">${meta}</div>`
      );
    }
  });
});

// ‚îÄ‚îÄ‚îÄ CARD ACTION LINK CLICKS ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.card-action').forEach(action => {
  action.style.cursor = 'pointer';
  action.addEventListener('click', () => {
    const text = action.textContent.trim();
    if (text.includes('Full Map')) {
      const mapRow = (market, vacancy, trend, trendColor, rent, status) =>
        `<div style="display:flex;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);">`
        + `<div style="flex:2;font-size:12px;color:var(--cream);">${market}</div>`
        + `<div style="width:55px;font-family:'JetBrains Mono',monospace;font-size:11px;color:${parseFloat(vacancy) > 15 ? 'var(--red)' : parseFloat(vacancy) > 10 ? 'var(--amber)' : 'var(--green)'};">${vacancy}</div>`
        + `<div style="width:55px;font-family:'JetBrains Mono',monospace;font-size:10px;color:${trendColor};">${trend}</div>`
        + `<div style="width:50px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--gold);">${rent}</div>`
        + `<div style="width:70px;font-size:10px;color:var(--text-mid);">${status}</div></div>`;
      showModal('Heatmap', 'West Coast Submarket Pulse ‚Äî Full View',
        `<div style="display:flex;gap:10px;padding:6px 0;border-bottom:1px solid var(--border-gold);margin-bottom:4px;font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--text-dim);letter-spacing:0.08em;">`
        + `<div style="flex:2;">SUBMARKET</div><div style="width:55px;">VACANCY</div><div style="width:55px;">90D Œî</div><div style="width:50px;">$/SF</div><div style="width:70px;">STATUS</div></div>`
        + mapRow('Manhattan Beach', '5.9%', '‚ñº 0.2%', 'var(--green)', '$56', 'Very Tight')
        + mapRow('El Segundo', '6.7%', '‚ñº 0.4%', 'var(--green)', '$48', 'Tight')
        + mapRow('West Hollywood', '7.3%', '‚ñº 0.5%', 'var(--green)', '$58', 'Tight')
        + mapRow('Playa Vista', '8.1%', '‚ñº 0.9%', 'var(--green)', '$68', 'Tightening')
        + mapRow('Bellevue WA', '9.2%', '‚ñº 1.0%', 'var(--green)', '$58', 'Recovering')
        + mapRow('Santa Monica', '9.8%', '‚ñº 1.1%', 'var(--green)', '$72', 'Tightening')
        + mapRow('Burbank', '10.4%', '‚ñº 0.7%', 'var(--green)', '$52', 'Stable')
        + mapRow('Seattle SLU', '11.0%', '‚ñº 0.6%', 'var(--green)', '$52', 'Recovering')
        + mapRow('Culver City', '11.2%', '‚ñº 0.6%', 'var(--green)', '$62', 'Tightening')
        + mapRow('Century City', '12.6%', '‚ñº 0.3%', 'var(--green)', '$82', 'Premium')
        + mapRow('SF Mission', '14.8%', '‚ñº 0.3%', 'var(--green)', '$54', 'Stabilizing')
        + mapRow('Wilshire Corridor', '16.1%', '‚ñ≤ 0.4%', 'var(--red)', '$46', 'Soft')
        + mapRow('DTLA', '18.4%', '‚ñ≤ 1.2%', 'var(--red)', '$54', 'Elevated')
        + mapRow('SF SOMA', '22.1%', '‚ñ≤ 1.4%', 'var(--red)', '$62', 'Distressed')
        + mapRow('SF Financial', '26.3%', '‚ñ≤ 2.1%', 'var(--red)', '$68', 'Distressed')
      );
    } else if (text.includes('View All') && action.closest('#agent-card')) {
      const logItem = (icon, cls, text, tag, tagCls, time, agent) =>
        `<div style="display:flex;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);cursor:pointer;">`
        + `<div style="width:28px;height:28px;border-radius:6px;background:var(--surface-3);display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;">${icon}</div>`
        + `<div style="flex:1;min-width:0;"><div style="font-size:12px;color:var(--text);line-height:1.5;">${text}</div>`
        + `<div style="display:flex;gap:8px;align-items:center;margin-top:3px;"><span style="font-size:9px;padding:2px 6px;border-radius:2px;background:var(--surface-3);color:var(--cream);font-family:'JetBrains Mono',monospace;letter-spacing:0.05em;">${tag}</span><span style="font-size:10px;color:var(--text-dim);">${time} ¬∑ ${agent}</span></div></div></div>`;
      showModal('Agent Feed', 'Full Agent Activity Log ‚Äî Today',
        `<div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:0.1em;margin-bottom:12px;">6 AGENTS ¬∑ 15 SUBMARKETS ¬∑ LAST 24 HOURS</div>`
        + logItem('‚ö°', '', '<strong>Snap Inc.</strong> vacating 42K SF at 2101 Colorado Ave SM ‚Äî 3 tenants circling.', 'High Priority', '', '2 min ago', 'Intel Agent')
        + logItem('üéØ', '', '<strong>TechCo Inc.</strong> (Series C) posted 40+ LA jobs. Office expansion signal.', 'New Lead', '', '14 min ago', 'Lead Agent')
        + logItem('üìã', '', '<strong>LOI Agent</strong> flagged non-standard exclusivity clause ‚Äî Apex Capital draft.', 'Document', '', '31 min ago', 'LOI Agent')
        + logItem('üîç', '', 'Zoning variance filed for <strong>1150 S Olive St</strong> ‚Äî mixed-use conversion.', 'Zoning', '', '1 hr ago', 'Permit Agent')
        + logItem('‚úâÔ∏è', '', '<strong>Outreach Agent</strong> drafting personalized pitch for Netflix HQ expansion.', 'In Progress', '', '1 hr ago', 'Outreach Agent')
        + logItem('üìà', '', '<strong>Fed signals pause.</strong> Cap rate compression model updated ‚Äî industrial -25bps.', 'Rate Watch', '', '1.5 hr ago', 'Macro Agent')
        + logItem('üåê', '', 'SF Financial District vacancy updated to <strong>26.3%</strong> ‚Äî highest in 18 months.', 'Market', '', '2 hr ago', 'Intel Agent')
        + logItem('üéØ', '', '<strong>Shopify</strong> subletting 18K SF in Santa Monica ‚Äî window opening.', 'New Lead', '', '2.5 hr ago', 'Lead Agent')
        + logItem('üìã', '', '<strong>LOI Agent</strong> completed Apex Capital clause comparison. 2 items flagged.', 'Document', '', '3 hr ago', 'LOI Agent')
        + logItem('üîç', '', 'Building permit approved for <strong>550 S Flower St</strong> ‚Äî Class A renovation.', 'Permit', '', '4 hr ago', 'Permit Agent')
        + logItem('üåê', '', 'Playa Vista badge-in data: <strong>74% occupancy</strong> vs 61% DTLA avg.', 'Intel', '', '4 hr ago', 'Intel Agent')
        + logItem('‚úâÔ∏è', '', '<strong>Outreach Agent</strong> sent WestShore Media pitch ‚Äî 3 property options.', 'Sent', '', '5 hr ago', 'Outreach Agent')
        + logItem('üìà', '', '10Y Treasury down 12bps to <strong>3.82%</strong>. Monitoring cap rate impact.', 'Rate Watch', '', '6 hr ago', 'Macro Agent')
        + logItem('üéØ', '', '<strong>Meridian Health Partners</strong> exploring Burbank for 9K SF clinic space.', 'New Lead', '', '8 hr ago', 'Lead Agent')
        + logItem('üåê', '', 'CBRE closed 18,500 SF at Water Garden. 3 remaining comparables in SM.', 'Market', '', '10 hr ago', 'Intel Agent')
      );
    } else if (text.includes('Mark All Read')) {
      document.querySelectorAll('.alert-item').forEach(a => a.style.opacity = '0.5');
      action.textContent = 'All Read ‚úì';
      action.style.color = 'var(--green)';
    } else if (text.includes('View All 14')) {
      const dealRow = (name, sub, market, sf, value, stage, stageCls, prob, probColor, close) =>
        `<div style="display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);cursor:pointer;">`
        + `<div style="flex:2;min-width:0;"><div style="font-size:12px;font-weight:600;color:var(--cream);">${name}</div><div style="font-size:10px;color:var(--text-dim);">${sub}</div></div>`
        + `<div style="flex:1;"><span style="font-size:10px;padding:2px 6px;border-radius:2px;background:var(--surface-3);color:var(--cream);font-family:'JetBrains Mono',monospace;">${market}</span></div>`
        + `<div style="width:50px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-mid);">${sf}</div>`
        + `<div style="width:45px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--gold);font-weight:600;">${value}</div>`
        + `<div style="width:70px;"><span style="font-size:9px;padding:2px 6px;border-radius:2px;background:var(--surface-3);color:var(--cream);font-family:'JetBrains Mono',monospace;">${stage}</span></div>`
        + `<div style="width:35px;font-family:'JetBrains Mono',monospace;font-size:10px;color:${probColor};">${prob}</div>`
        + `<div style="width:50px;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text-dim);">${close}</div></div>`;
      showModal('Deal Pipeline', 'All Active Deals ‚Äî 14',
        `<div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:0.1em;margin-bottom:4px;">TOTAL PIPELINE VALUE: $218M</div>`
        + `<div style="display:flex;gap:12px;margin-bottom:14px;">`
        + `<span style="font-size:10px;color:var(--text-dim);">Prospect: 3</span>`
        + `<span style="font-size:10px;color:var(--blue);">Qualifying: 4</span>`
        + `<span style="font-size:10px;color:var(--amber);">Proposal: 4</span>`
        + `<span style="font-size:10px;color:var(--gold);">LOI: 2</span>`
        + `<span style="font-size:10px;color:var(--green);">Closing: 1</span></div>`
        + `<div style="display:flex;gap:10px;padding:6px 0;border-bottom:1px solid var(--border-gold);margin-bottom:4px;font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--text-dim);letter-spacing:0.08em;">`
        + `<div style="flex:2;">TENANT</div><div style="flex:1;">MARKET</div><div style="width:50px;">SF</div><div style="width:45px;">VALUE</div><div style="width:70px;">STAGE</div><div style="width:35px;">PROB</div><div style="width:50px;">CLOSE</div></div>`
        + dealRow('Netflix Inc.', 'HQ Expansion ¬∑ TAMI', 'Culver City', '~60K', '$42M', 'Proposal', '', '72%', 'var(--green)', "Apr '26")
        + dealRow('Apex Capital Group', 'Relocation ¬∑ Financial', 'Century City', '28.5K', '$19M', 'LOI Signed', '', '88%', 'var(--green)', "Mar '26")
        + dealRow('TechCo Inc.', 'New Requirement ¬∑ SaaS', 'Playa Vista', '~20K', '$11M', 'Qualifying', '', '38%', 'var(--amber)', "Q3 '26")
        + dealRow('WestShore Media', 'Expansion ¬∑ Media', 'Santa Monica', '14.2K', '$8.5M', 'Proposal', '', '61%', 'var(--cream)', "May '26")
        + dealRow('Meridian Health', 'New Req. ¬∑ Healthcare', 'Burbank', '9K', '$4.2M', 'Prospect', '', '24%', 'var(--red)', "Q4 '26")
        + dealRow('Pacific Ventures', 'Relocation ¬∑ VC', 'Santa Monica', '12K', '$7.8M', 'Proposal', '', '55%', 'var(--cream)', "Jun '26")
        + dealRow('Horizon Biotech', 'Expansion ¬∑ Life Sci', 'El Segundo', '22K', '$14M', 'Qualifying', '', '42%', 'var(--amber)', "Q3 '26")
        + dealRow('Catalyst Media', 'New Req. ¬∑ Media', 'Culver City', '8.5K', '$5.1M', 'Qualifying', '', '35%', 'var(--amber)', "Q4 '26")
        + dealRow('Summit Legal Group', 'Expansion ¬∑ Legal', 'Century City', '18K', '$16M', 'LOI Signed', '', '82%', 'var(--green)', "Apr '26")
        + dealRow('CloudNine Software', 'New Req. ¬∑ SaaS', 'Playa Vista', '11K', '$6.8M', 'Prospect', '', '18%', 'var(--red)', "2027")
        + dealRow('Verde Architects', 'Relocation ¬∑ Design', 'W. Hollywood', '5.5K', '$3.2M', 'Proposal', '', '58%', 'var(--cream)', "May '26")
        + dealRow('Arclight Partners', 'Expansion ¬∑ Finance', 'DTLA', '35K', '$18M', 'Qualifying', '', '45%', 'var(--amber)', "Q3 '26")
        + dealRow('Zenith Healthcare', 'New Req. ¬∑ Healthcare', 'Burbank', '7K', '$3.4M', 'Prospect', '', '22%', 'var(--red)', "Q4 '26")
        + dealRow('Pinnacle Studios', 'Expansion ¬∑ Entertain.', 'Burbank', '45K', '$30M', 'Closing', '', '94%', 'var(--green)', "Mar '26")
      );
    }
  });
});

// ‚îÄ‚îÄ‚îÄ NOTIFICATION BELL + SETTINGS GEAR ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.icon-btn').forEach((btn, i) => {
  btn.style.cursor = 'pointer';
  btn.addEventListener('click', () => {
    if (i === 0) { // Bell
      showModal('Notifications', '7 Unread Notifications',
        `<div style="display:flex;flex-direction:column;gap:8px;">`
        + `<div style="padding:10px 12px;background:var(--red-dim);border:1px solid rgba(192,83,58,0.2);border-radius:6px;"><div style="font-size:12px;font-weight:600;color:var(--cream);">‚ö° Snap vacating 42K SF</div><div style="font-size:10px;color:var(--text-dim);margin-top:2px;">2 min ago ¬∑ Intel Agent</div></div>`
        + `<div style="padding:10px 12px;background:var(--red-dim);border:1px solid rgba(192,83,58,0.2);border-radius:6px;"><div style="font-size:12px;font-weight:600;color:var(--cream);">üìã LOI Clause Mismatch</div><div style="font-size:10px;color:var(--text-dim);margin-top:2px;">31 min ago ¬∑ LOI Agent</div></div>`
        + `<div style="padding:10px 12px;background:var(--gold-dim);border:1px solid var(--border-gold);border-radius:6px;"><div style="font-size:12px;font-weight:600;color:var(--cream);">üéØ TechCo Expansion Signal</div><div style="font-size:10px;color:var(--text-dim);margin-top:2px;">14 min ago ¬∑ Lead Agent</div></div>`
        + `<div style="padding:10px 12px;background:var(--surface-2);border:1px solid var(--border);border-radius:6px;"><div style="font-size:12px;font-weight:600;color:var(--cream);">üìà Interest Rate Watch</div><div style="font-size:10px;color:var(--text-dim);margin-top:2px;">1h ago ¬∑ Macro Agent</div></div>`
        + `</div>`
      );
    } else { // Settings
      showModal('Settings', 'Dashboard Preferences',
        detailRow('Morning Brief Time', '6:00 AM PST', 'var(--cream)')
        + detailRow('Delivery Channels', 'Dashboard + Email', 'var(--cream)')
        + detailRow('Active Agents', '6 of 6', 'var(--green)')
        + detailRow('Monitored Submarkets', '15', 'var(--cream)')
        + detailRow('Alert Threshold', 'Medium + High', 'var(--cream)')
        + detailRow('Plan', 'Pro ¬∑ 3 seats', 'var(--gold)')
        + `<div style="margin-top:16px;"><button style="width:100%;padding:10px;background:var(--surface-2);border:1px solid var(--border);border-radius:4px;color:var(--text);font-family:'Syne',sans-serif;font-size:12px;cursor:pointer;">Edit Preferences ‚Üí</button></div>`
      );
    }
  });
});

// ‚îÄ‚îÄ‚îÄ SPARKLINE BAR CLICKS ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.spark-bar').forEach(bar => {
  bar.style.cursor = 'pointer';
  bar.addEventListener('click', () => {
    const card = bar.closest('.spark-card');
    const title = card?.querySelector('.card-title')?.textContent || 'Chart Detail';
    const big = card?.querySelector('.spark-big')?.textContent || '';
    const delta = card?.querySelector('.spark-delta')?.textContent || '';
    showModal('Chart', title,
      `<div style="font-family:'Cormorant Garamond',serif;font-size:36px;font-weight:600;color:var(--cream);margin-bottom:4px;">${big}</div>`
      + `<div style="font-size:13px;color:${delta.includes('‚ñ≤') ? 'var(--green)' : 'var(--red)'};margin-bottom:16px;">${delta}</div>`
      + `<div style="font-size:13px;color:var(--text);line-height:1.6;">Detailed trend analysis and period-over-period comparison would appear here. Click any bar in the sparkline to drill into that specific time period.</div>`
    );
  });
});

// ‚îÄ‚îÄ‚îÄ ACTION DOTS (‚ãØ) ON PIPELINE ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.action-dots').forEach((dots, i) => {
  dots.style.cursor = 'pointer';
  dots.addEventListener('click', (e) => {
    e.stopPropagation();
    const d = dealDetails[i];
    if (!d) return;
    showModal('Deal Actions', d.name,
      `<div style="display:flex;flex-direction:column;gap:8px;">`
      + `<button onclick="closeModal()" style="padding:12px;background:var(--surface-2);border:1px solid var(--border);border-radius:6px;color:var(--cream);font-family:'Syne',sans-serif;font-size:13px;cursor:pointer;text-align:left;">üìù Edit Deal Details</button>`
      + `<button onclick="closeModal()" style="padding:12px;background:var(--surface-2);border:1px solid var(--border);border-radius:6px;color:var(--cream);font-family:'Syne',sans-serif;font-size:13px;cursor:pointer;text-align:left;">üìä Update Stage</button>`
      + `<button onclick="closeModal()" style="padding:12px;background:var(--surface-2);border:1px solid var(--border);border-radius:6px;color:var(--cream);font-family:'Syne',sans-serif;font-size:13px;cursor:pointer;text-align:left;">‚úâÔ∏è Draft Follow-Up</button>`
      + `<button onclick="closeModal()" style="padding:12px;background:var(--surface-2);border:1px solid var(--border);border-radius:6px;color:var(--cream);font-family:'Syne',sans-serif;font-size:13px;cursor:pointer;text-align:left;">üìã Export to CRM</button>`
      + `<button onclick="closeModal()" style="padding:12px;background:var(--red-dim);border:1px solid rgba(192,83,58,0.2);border-radius:6px;color:var(--red);font-family:'Syne',sans-serif;font-size:13px;cursor:pointer;text-align:left;">üóë Archive Deal</button>`
      + `</div>`
    );
  });
});

// ‚îÄ‚îÄ‚îÄ SIDEBAR TOGGLE FOR MOBILE ‚îÄ‚îÄ‚îÄ
(function() {
  const sidebarToggle = document.getElementById('sidebar-toggle');
  const sidebar = document.getElementById('sidebar');

  if (sidebarToggle && sidebar) {
    sidebarToggle.addEventListener('click', function(e) {
      e.preventDefault();
      sidebarToggle.classList.toggle('active');
      sidebar.classList.toggle('active');
    });

    // Close sidebar when clicking on a nav item
    sidebar.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', function() {
        sidebarToggle.classList.remove('active');
        sidebar.classList.remove('active');
      });
    });

    // Close sidebar when clicking outside (only on mobile)
    document.addEventListener('click', function(event) {
      if (window.innerWidth <= 900) {
        if (!sidebar.contains(event.target) && !sidebarToggle.contains(event.target)) {
          sidebarToggle.classList.remove('active');
          sidebar.classList.remove('active');
        }
      }
    });
  }
})();

// ‚îÄ‚îÄ‚îÄ DYNAMIC DATE ‚îÄ‚îÄ‚îÄ
(function() {
  const el = document.getElementById('topbar-date');
  if (!el) return;
  const now = new Date();
  const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const h = now.getHours(), m = now.getMinutes();
  const ampm = h >= 12 ? 'PM' : 'AM';
  const h12 = h % 12 || 12;
  const mm = m < 10 ? '0' + m : m;
  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
  const tzAbbr = now.toLocaleTimeString('en-US', {timeZoneName:'short'}).split(' ').pop();
  el.textContent = `${days[now.getDay()]}, ${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()} ¬∑ ${h12}:${mm} ${ampm} ${tzAbbr}`;
})();

// ‚îÄ‚îÄ‚îÄ SIDEBAR NAV CLICK HANDLERS ‚îÄ‚îÄ‚îÄ
(function() {
  const navHandlers = {
    'nav-brief': () => showModal('Morning Brief', 'Today\'s Morning Brief',
      `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">Your morning brief aggregates overnight intelligence from all 6 agents across your monitored markets.</div>`
      + detailRow('Brief Time', '6:00 AM PST', 'var(--cream)')
      + detailRow('Markets Covered', '15 submarkets', 'var(--cream)')
      + detailRow('New Alerts Overnight', '7', 'var(--gold)')
      + detailRow('Agent Updates', '12 items processed', 'var(--green)')
      + `<div style="margin-top:16px;padding:12px;background:var(--gold-dim);border:1px solid var(--border-gold);border-radius:6px;font-size:12px;color:var(--gold);">Top Priority: Snap Inc. vacating 42K SF in Santa Monica. First-mover window ~6 weeks.</div>`
    ),
    'nav-agents': () => showModal('Agent Fleet', 'Your AI Agent Fleet ‚Äî 6 Active',
      `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">All agents are running and monitoring your markets in real time.</div>`
      + detailRow('Intel Agent', '‚óè Active ‚Äî 4 updates today', 'var(--green)')
      + detailRow('Lead Agent', '‚óè Active ‚Äî 2 leads found', 'var(--green)')
      + detailRow('LOI Agent', '‚óè Active ‚Äî 1 document reviewed', 'var(--green)')
      + detailRow('Outreach Agent', '‚óè Active ‚Äî 1 draft in progress', 'var(--gold)')
      + detailRow('Permit Agent', '‚óè Active ‚Äî 1 zoning alert', 'var(--green)')
      + detailRow('Macro Agent', '‚óè Active ‚Äî rate watch triggered', 'var(--green)')
    ),
    'nav-pipeline': () => showModal('Deal Pipeline', 'Active Deal Pipeline ‚Äî 14 Deals',
      `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">Total pipeline value: $218M. 3 new deals this month. Click any row in the pipeline table for details.</div>`
      + detailRow('Prospect', '3 deals ¬∑ $12M', 'var(--text-mid)')
      + detailRow('Qualifying', '4 deals ¬∑ $38M', 'var(--blue)')
      + detailRow('Proposal', '4 deals ¬∑ $86M', 'var(--amber)')
      + detailRow('LOI Signed', '2 deals ¬∑ $52M', 'var(--gold)')
      + detailRow('Closing', '1 deal ¬∑ $30M', 'var(--green)')
    ),
    'nav-leads': () => showModal('Tenant Leads', 'Agent-Sourced Tenant Leads ‚Äî 3 New',
      `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">Your Lead Agent has identified 3 new high-intent tenants in your coverage area this week.</div>`
      + detailRow('TechCo Inc.', '‚óè Very High Intent ‚Äî 40+ jobs, WeWork +62%', 'var(--green)')
      + detailRow('Shopify (sublease)', '‚óè High Intent ‚Äî 18K SF Santa Monica', 'var(--gold)')
      + detailRow('Meridian Health', '‚óÜ Moderate ‚Äî exploring Burbank/Glendale', 'var(--amber)')
    )
  };

  // Sidebar items with IDs
  Object.keys(navHandlers).forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.style.cursor = 'pointer';
      el.addEventListener('click', navHandlers[id]);
    }
  });

  // Sidebar items without IDs (Market Intel, reports, preferences, etc.)
  document.querySelectorAll('.nav-item').forEach(item => {
    const text = item.textContent.trim();
    if (text.includes('Market Intel')) {
      item.style.cursor = 'pointer';
      item.addEventListener('click', () => showModal('Market Intel', 'Market Intelligence Overview',
        `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">Aggregated market intelligence across all monitored submarkets. Your agents are watching 15 submarkets for vacancy changes, new listings, and zoning updates.</div>`
        + detailRow('Total Submarkets', '15', 'var(--cream)')
        + detailRow('Avg. Vacancy (LA)', '14.2%', 'var(--amber)')
        + detailRow('Avg. Vacancy (SF)', '21.1%', 'var(--red)')
        + detailRow('Avg. Vacancy (SEA)', '10.1%', 'var(--green)')
      ));
    } else if (text.includes('West Coast Markets')) {
      item.style.cursor = 'pointer';
      item.addEventListener('click', () => showModal('Report', 'West Coast Markets Report',
        `<div style="font-size:13px;color:var(--text);line-height:1.7;">Comprehensive report covering LA, SF, and Seattle metro CRE markets. Updated weekly by your Intel Agent.</div>`
      ));
    } else if (text.includes('Submarket Tracker')) {
      item.style.cursor = 'pointer';
      item.addEventListener('click', () => showModal('Report', 'Submarket Tracker',
        `<div style="font-size:13px;color:var(--text);line-height:1.7;">Track vacancy trends, rent comps, and absorption across all 15 monitored submarkets. Historical data up to 24 months.</div>`
      ));
    } else if (text.includes('Portfolio Analysis')) {
      item.style.cursor = 'pointer';
      item.addEventListener('click', () => showModal('Report', 'Portfolio Analysis',
        `<div style="font-size:13px;color:var(--text);line-height:1.7;">Analyze your active deals and pipeline performance. Win rates, average close times, and revenue projections.</div>`
      ));
    } else if (text.includes('Preferences')) {
      item.style.cursor = 'pointer';
      item.addEventListener('click', () => showModal('Settings', 'Dashboard Preferences',
        detailRow('Morning Brief Time', '6:00 AM PST', 'var(--cream)')
        + detailRow('Delivery Channels', 'Dashboard + Email', 'var(--cream)')
        + detailRow('Active Agents', '6 of 6', 'var(--green)')
        + detailRow('Monitored Submarkets', '15', 'var(--cream)')
        + detailRow('Alert Threshold', 'Medium + High', 'var(--cream)')
        + detailRow('Plan', 'Pro ¬∑ 3 seats', 'var(--gold)')
      ));
    } else if (text.includes('Brief Schedule')) {
      item.style.cursor = 'pointer';
      item.addEventListener('click', () => showModal('Settings', 'Brief Schedule',
        `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">Configure when and how your morning briefs are delivered.</div>`
        + detailRow('Morning Brief', '6:00 AM PST ¬∑ Daily', 'var(--cream)')
        + detailRow('Weekly Digest', 'Monday 8:00 AM ¬∑ Weekly', 'var(--cream)')
        + detailRow('Delivery', 'Dashboard + Email', 'var(--cream)')
      ));
    }
  });

  // Profile card click
  const profileCard = document.getElementById('nav-profile');
  if (profileCard) {
    profileCard.style.cursor = 'pointer';
    profileCard.addEventListener('click', () => {
      const name = profileCard.querySelector('.user-name')?.textContent || 'User';
      const email = profileCard.querySelector('.user-title')?.textContent || '';
      showModal('Profile', name,
        `<div style="font-size:13px;color:var(--text);line-height:1.7;margin-bottom:16px;">${email}</div>`
        + detailRow('Plan', 'Pro ¬∑ 3 seats', 'var(--gold)')
        + detailRow('Markets', '15 submarkets', 'var(--cream)')
        + detailRow('Active Agents', '6', 'var(--green)')
        + detailRow('Intelligence Watches', '4 active', 'var(--cream)')
      );
    });
  }
})();

// ‚îÄ‚îÄ‚îÄ MAKE NEW STREAM ITEMS CLICKABLE ‚îÄ‚îÄ‚îÄ
const origPrepend = Element.prototype.prepend;
const streamEl = document.getElementById('agentStream');
if (streamEl) {
  const observer = new MutationObserver(mutations => {
    mutations.forEach(m => {
      m.addedNodes.forEach(node => {
        if (node.nodeType === 1 && node.classList.contains('stream-item') && !node._clickBound) {
          node._clickBound = true;
          node.style.cursor = 'pointer';
          node.addEventListener('click', () => {
            const text = node.querySelector('.stream-text')?.innerHTML || '';
            const meta = node.querySelector('.stream-meta')?.textContent || '';
            showModal('Agent Activity', 'Activity Detail',
              `<div style="font-size:14px;color:var(--text);line-height:1.7;margin-bottom:16px;">${text}</div>`
              + `<div style="font-size:11px;color:var(--text-dim);">${meta}</div>`
            );
          });
        }
      });
    });
  });
  observer.observe(streamEl, { childList: true });
}
</script>

<!-- ‚îÄ‚îÄ‚îÄ AUTH GATE ‚îÄ‚îÄ‚îÄ -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script src="/js/supabase-config.js"></script>
<script>
(async function dashboardAuth() {
  try {
    // Check if Supabase loaded
    if (typeof LandMarqAuth === 'undefined') {
      console.error('LandMarq: Auth library not loaded');
      window.location.href = '/login?returnTo=/dashboard';
      return;
    }

    // Gate: require login
    const session = await LandMarqAuth.requireAuth();
    if (!session) return; // redirect happening

    // Populate user info in sidebar
    const user = session.user;
    const email = user.email || '';
    const meta = user.user_metadata || {};
    const displayName = meta.full_name || meta.name || email.split('@')[0];
    const initials = displayName.charAt(0).toUpperCase();

    const avatarEl = document.querySelector('#nav-profile .user-avatar');
    const nameEl = document.querySelector('#nav-profile .user-name');
    const titleEl = document.querySelector('#nav-profile .user-title');

    if (avatarEl) avatarEl.textContent = initials;
    if (nameEl) nameEl.textContent = displayName;
    if (titleEl) titleEl.textContent = email;

    // Show the page
    document.body.classList.add('auth-ready');
  } catch (err) {
    console.error('LandMarq auth error:', err);
    window.location.href = '/login?returnTo=/dashboard';
  }
})();
</script>

</body>
</html>
